(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"0339":function(e,t,s){"use strict";s("f02f")},"33b4":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"intervals-page"},[t("q-resize-observer",{on:{resize:e.onResizePage}}),t("q-toolbar",{staticClass:"justify-between q-py-none bg-grey-9"},[t("div",{staticClass:"flex",staticStyle:{width:"75%"}},[t("div",{staticClass:"q-mr-sm",staticStyle:{display:"inline-flex"},style:{maxWidth:e.$q.platform.is.mobile?"48%":"40%"}},[t("q-select",{ref:"itemDeviceSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.active},attrs:{value:e.active,options:e.filteredDevices,filled:"",label:e.active?void 0:"SELECT DEVICE",dark:"","hide-bottom-space":"",dense:"",color:"white",disable:e.devicesSelectorDisabled,"hide-dropdown-icon":e.devicesSelectorDisabled,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredDevices.length>6?6:e.filteredDevices.length)+48+(e.filteredDevices.length?0:34)+"px"}},on:{filter:e.filterDevicesSelectItems},scopedSlots:e._u([{key:"no-option",fn:function(){return[t("div",{staticStyle:{"min-height":"77px"}},[t("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:t=>e.$refs.itemDeviceSelect.filter(t)},model:{value:e.deviceFilter,callback:function(t){e.deviceFilter=t},expression:"deviceFilter"}},[t("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),t("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(s){return[t("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"margin-top":"2px","max-width":"100%","min-height":"auto"}},"q-item",s.itemProps,!1),s.itemEvents),[t("q-item-section",[t("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedDevice.name||"<noname>"))]),t("q-item-label",{staticClass:"q-pa-none q-mt-none text-white ellipsis",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[t("small",[e._v(e._s(e.selectedDevice.configuration&&e.selectedDevice.configuration.ident?e.selectedDevice.configuration.ident:"<no ident>"))])])],1),e.$q.platform.is.desktop?t("q-item-section",{staticClass:"text-white",attrs:{side:""}},[t("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[t("small",[e._v("#"+e._s(e.selectedDevice.id))])])],1):e._e()],1)]}},{key:"option",fn:function(s){return[t("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":s.opt.deleted},attrs:{clickable:""},on:{click:function(t){return e.setActive(s.opt.id)}}},"q-item",s.itemProps,!1),s.itemEvents),[t("q-item-section",[t("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(s.opt.name||"<noname>"))]),t("q-item-label",{staticClass:"q-pa-none q-mt-none",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[t("small",[e._v(e._s(s.opt.configuration&&s.opt.configuration.ident?s.opt.configuration.ident:"<no ident>"))])])],1),e.$q.platform.is.desktop?t("q-item-section",{attrs:{side:""}},[t("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[t("small",[e._v("#"+e._s(s.opt.id))])])],1):e._e()],1)]}}])},[t("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[t("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:t=>e.$refs.itemDeviceSelect.filter(t)},model:{value:e.deviceFilter,callback:function(t){e.deviceFilter=t},expression:"deviceFilter"}},[t("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.$q.platform.is.desktop?t("q-icon",{attrs:{slot:"prepend",name:"mdi-developer-board",color:"white"},slot:"prepend"}):e._e()],1)],1),t("div",{staticStyle:{display:"inline-flex"},style:{maxWidth:e.$q.platform.is.mobile?"48%":"40%"}},[t("q-select",{ref:"itemCalcSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.activeCalcId},attrs:{value:e.activeCalcId,options:e.filteredCalcs,filled:"",disable:e.calcsSelectorDisabled,"hide-dropdown-icon":e.calcsSelectorDisabled,label:e.activeCalcId?void 0:"SELECT CALC",dark:"","hide-bottom-space":"",dense:"",color:"white","popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredCalcs.length>6?6:e.filteredCalcs.length)+48+(e.filteredCalcs.length?0:34)+"px"}},on:{filter:e.filterCalcsSelectItems},scopedSlots:e._u([{key:"no-option",fn:function(){return[t("div",{staticStyle:{"min-height":"77px"}},[t("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:t=>e.$refs.itemCalcSelect.filter(t)},model:{value:e.calcFilter,callback:function(t){e.calcFilter=t},expression:"calcFilter"}},[t("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),t("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(s){return[e.selectedCalc?t("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",s.itemProps,!1),s.itemEvents),[t("q-item-section",[t("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedCalc.name||"<noname>"))])],1),e.$q.platform.is.desktop?t("q-item-section",{staticClass:"text-white",attrs:{side:""}},[t("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[t("small",[e._v("#"+e._s(e.selectedCalc.id))])])],1):e._e()],1):e._e()]}},{key:"option",fn:function(s){return[t("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":s.opt.deleted},attrs:{clickable:""},on:{click:function(t){return e.setActiveCalc(s.opt.id)}}},"q-item",s.itemProps,!1),s.itemEvents),[t("q-item-section",[t("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(s.opt.name||"<noname>"))])],1),e.$q.platform.is.desktop?t("q-item-section",{attrs:{side:""}},[t("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[t("small",[e._v("#"+e._s(s.opt.id))])])],1):e._e()],1)]}}])},[t("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[t("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:t=>e.$refs.itemCalcSelect.filter(t)},model:{value:e.calcFilter,callback:function(t){e.calcFilter=t},expression:"calcFilter"}},[t("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.$q.platform.is.desktop?t("q-icon",{attrs:{slot:"prepend",name:"mdi-calculator-variant",color:"white"},slot:"prepend"}):e._e()],1)],1)]),e.$q.platform.is.desktop?t("div",{staticClass:"flex justify-end",style:{width:72*e.actions.length+"px"}},[e._l(e.actions,(function(s,i){return[s.condition?t("transition",{key:i,attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[t("q-btn",{staticClass:"on-left cursor-pointer pull-right text-center rounded-borders q-px-xs q-py-none text-white",staticStyle:{"max-width":"60px"},attrs:{title:s.label,flat:"",dense:""},on:{click:s.handler}},[t("q-icon",{attrs:{size:"1.5rem",name:s.icon}}),t("div",{staticStyle:{"font-size":".7rem","line-height":".7rem"}},[e._v(e._s(s.label))]),s.desc?t("q-tooltip",[e._v(e._s(s.desc))]):e._e()],1)],1):e._e()]}))],2):t("div",[e.hasActiveActions?t("q-btn",{attrs:{flat:"",icon:"mdi-dots-vertical",color:"white"}},[t("q-menu",{attrs:{"no-route-dismiss":""}},[t("q-list",[e._l(e.actions,(function(s,i){return[s.condition?t("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:i,attrs:{clickable:""},on:{click:s.handler}},[t("q-item-section",{attrs:{avatar:""}},[t("q-icon",{attrs:{name:s.icon}})],1),t("q-item-section",[e._v(e._s(s.label))])],1):e._e()]}))],2)],1)],1):e._e()],1)]),t("div",[e.isInit?t("intervals",{ref:"intervals",style:{height:`calc(50vh - ${e.isVisibleToolbar?"50px":"25px"})`,position:"relative",...e.panelsWidgetsStyle},attrs:{activeId:e.activeCalcId,item:e.selectedCalc,activeDeviceId:e.active,limit:0,config:e.config.intervals},on:{"action-view-data":t=>e.intervalWidgetsActions("object",{...t,refName:"intervals"}),"action-map":t=>e.intervalWidgetsActions("track",{...t,refName:"intervals"}),"action-show":t=>e.intervalWidgetsActions("show",{...t,refName:"intervals"}),"action-select":t=>e.intervalWidgetsActions("select",{...t,refName:"intervals"}),"in-messages":t=>e.viewedInterval=t,"change:date-range":e.dateRangeChange}}):e._e(),e.isInit&&!e.relatedDataMode?t("messages",{ref:"messages",style:[{height:`calc(50vh - ${e.isVisibleToolbar?"50px":"25px"})`,position:"relative"},e.panelsWidgetsStyle],attrs:{item:e.selectedDevice,interval:e.viewedInterval,dateRange:e.dateRange,activeId:e.active,limit:e.limit,config:e.config.messages},on:{"action-view-data":t=>e.messageWidgetsActions("object",t),"action-map":t=>e.messageWidgetsActions("position",t),"action-show":t=>e.messageWidgetsActions("show",t),"action-image":t=>e.messageWidgetsActions("image",t),"action-select":t=>e.messageWidgetsActions("select",t)}}):e.isInit&&e.relatedDataMode&&e.relatedCalcId?t("intervals",{ref:"relatedIntervals",style:[{height:`calc(50vh - ${e.isVisibleToolbar?"50px":"25px"})`,position:"relative"},e.panelsWidgetsStyle],attrs:{interval:e.viewedInterval,dateRange:e.dateRange,activeId:e.relatedCalcId,item:e.relatedCalc,activeDeviceId:e.active,limit:0,config:e.config.relatedIntervals},on:{"action-view-data":t=>e.intervalWidgetsActions("object",{...t,refName:"relatedIntervals"}),"action-map":t=>e.intervalWidgetsActions("track",{...t,refName:"relatedIntervals"}),"action-show":t=>e.intervalWidgetsActions("show",{...t,refName:"relatedIntervals"}),"action-select":t=>e.intervalWidgetsActions("select",{...t,refName:"relatedIntervals"})}}):e._e()],1),t("widgets",{ref:"messagesView",attrs:{active:"messagesView"===e.activeWidgetWindow,config:e.messageWidgetsViewConfig,actions:e.widgetsHandleActions,controls:e.widgetWindowControls,"view-model":e.widgetsViewModel.data},on:{"change-view-model":t=>e.widgetsChangeViewModelHandler(e.entityName,"data",t),active:function(t){return e.activateWidgetWindow("messagesView")},close:e.unselect,next:e.nextWidgetsMessage,prev:e.prevWidgetsMessage},model:{value:e.isWidgetsMessageActive,callback:function(t){e.isWidgetsMessageActive=t},expression:"isWidgetsMessageActive"}}),t("widgets",{ref:"intervalsView",attrs:{active:"intervalsView"===e.activeWidgetWindow,config:e.intervalsWidgetsViewConfig,actions:e.widgetsHandleActions,controls:e.widgetWindowControls,"view-model":e.widgetsViewModel.data},on:{"change-view-model":t=>e.widgetsChangeViewModelHandler(e.entityName,"data",t),active:function(t){return e.activateWidgetWindow("intervalsView")},close:e.unselect,next:e.nextWidgetsInterval,prev:e.prevWidgetsInterval},model:{value:e.isWidgetsIntervalsActive,callback:function(t){e.isWidgetsIntervalsActive=t},expression:"isWidgetsIntervalsActive"}})],1)},a=[],l=(s("14d9"),function(){var e=this,t=e._self._c;return t("div",[t("virtual-scroll-list",{ref:"scrollList",class:{"non-selectable":e.selectionMode},attrs:{name:"IntervalsVirtualScroll",cols:e.cols,actions:e.actions,panelActions:e.panelActions,items:e.messages,dateRange:[e.begin,e.end],viewConfig:e.viewConfig,filter:e.filter,theme:e.theme,title:"Intervals",loading:e.loadingFlag,autoscroll:e.needAutoscroll,scrollOffset:"10%",i18n:e.i18n,item:e.listItem,itemprops:e.getItemsProps},on:{scroll:e.scrollHandler,action:e.actionHandler,"change-filter":e.filterChangeHandler,"change-date-range":e.dateRangeChangeHandler,"update-cols":e.updateColsHandler,"action-to-bottom":e.actionToBottomHandler,arrowup:e.arrowUpHandler,arrowdown:e.arrowDownHandler},nativeOn:{click:function(t){return e.tableClickHandler.apply(null,arguments)}}},[t("empty-pane",{attrs:{slot:"empty",config:e.config.emptyState},slot:"empty"})],1)],1)}),n=[],o=s("de45"),c=s("2b0e"),r=s("b047c"),d=s.n(r),h=s("cdde"),m=function(){var e=this,t=e._self._c;return t("div",{style:{height:`${e.itemHeight}px`,width:`${e.rowWidth}px`},on:{click:t=>e.itemClickHandler(e.index,e.item,t)}},[t("div",{staticClass:"cursor-pointer",class:[e.item["x-flespi-status"]?"missed-items":"",e.highlighted&&!e.selected?"bg-purple-9":""],style:{height:`${e.itemHeight}px`,width:`${e.rowWidth}px`,backgroundColor:e.selected?"rgba(255,255,255,0.7)":"",color:e.selected&&!e.highlighted?"#333":""}},[e._l(e.cols,(function(s,i){return["etc"===s.__dest?t("span",{key:s.name+i,staticClass:"list__item item_etc",class:{[`item_${i}`]:!0,"item--active":e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i}},[e._v(e._s(e.values.etc.value||"*Empty*"))]):t("span",{key:s.name+i,staticClass:"list__item",class:{[`item_${i}`]:!0,"item--active":e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i},attrs:{title:e.values[s.name].value}},[e._v("\n        "+e._s(e.values[s.name].value)+"\n      ")])]}))],2)])},g=[],u=s("bd4c"),p={props:["item","index","actions","cols","itemHeight","rowWidth","selected","highlighted","menuCellActive"],data(){return{date:u["a"]}},computed:{values(){let e={};return e=this.cols.length?this.cols.reduce(((e,t,s,i)=>(e[t.name]={value:this.getValueOfProp(t,this.item)},s===i.length-1&&(e.etc={value:""}),e)),{}):{etc:{value:""}},Object.keys(this.item).forEach((t=>{e[t]||(-1!==t.indexOf("image.bin.")?e.etc.value+=`${t}: <binary image>`:e.etc.value+=`${t}: ${JSON.stringify(this.item[t])}; `)})),e}},methods:{clickHandler(e,t,s){this.$emit("action",{index:e,type:t,content:s})},itemClickHandler(e,t,s){this.$emit("item-click",{index:e,content:t,event:s})},getValueOfProp(e,t){const s=e.name;let i=t[s];return s.match(/timestamp$/)||"begin"===s||"end"===s?i=u["a"].formatDate(1e3*i,"DD/MM/YYYY HH:mm:ss"):-1!==s.indexOf("image.bin.")&&i&&(i="<binary image>"),"string"!==typeof i&&(i=JSON.stringify(i)),i}}},v=p,f=(s("3a59"),s("2877")),$=Object(f["a"])(v,m,g,!1,null,"7a1c0ce1",null),b=$.exports,w=s("121a"),y=s("0463"),C=s("6126"),N=s("db49"),x=s("b609"),I=s("c9ad"),k={props:["item","activeId","activeDeviceId","limit","config","interval","dateRange"],data(){return{listItem:b,theme:this.config.theme,isSecondary:"secondary"===this.config.mode,routeParamName:"secondary"===this.config.mode?"related_intervals":"intervals",moduleName:this.config.vuexModuleName,autoscroll:!0,isInit:!1,scrollTimestamp:void 0,viewedInterval:null,actions:this.config.actions,i18n:{"Columns by schema":"Columns by counters"}}},computed:{messages:{get(){let e=this.$store.state[this.moduleName].messages;return e=Object.values(e),e.sort(((e,t)=>e.begin-t.begin)),this.normalizeSelected(e),e},set(e){this.$store.commit(`${this.moduleName}/setMessages`,e)}},active:{get(){return this.$store.state[this.moduleName].active},async set(e){await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.$store.commit(`${this.moduleName}/setActive`,e),this.$store.commit(`${this.moduleName}/clearMessages`);const t=this.item.counters||[];e&&this.$store.dispatch(`${this.moduleName}/getCols`,t),await this.$store.dispatch(`${this.moduleName}/initTime`),this.$emit("change:date-range",[this.begin,this.end]),await this.$store.dispatch(`${this.moduleName}/get`),this.$store.dispatch(`${this.moduleName}/pollingGet`)}},activeDevice:{get(){return this.$store.state[this.moduleName].activeDevice},async set(e){await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.$store.commit(`${this.moduleName}/setActiveDevice`,e),this.$store.commit(`${this.moduleName}/clearMessages`),await this.$store.dispatch(`${this.moduleName}/initTime`),this.$emit("change:date-range",[this.begin,this.end]),await this.$store.dispatch(`${this.moduleName}/get`),this.$store.dispatch(`${this.moduleName}/pollingGet`)}},cols:{get(){return this.$store.state[this.moduleName].cols},set(e){this.$store.commit(`${this.moduleName}/updateCols`,e)}},filter:{get(){return this.$store.state[this.moduleName].filter},set(e){e=e||"",this.$store.commit(`${this.moduleName}/setFilter`,e)}},begin:{get(){const e=this.isSecondary?this.dateRange[0]:this.$store.state[this.moduleName].begin;return e},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setBegin`,e)}},end:{get(){const e=this.isSecondary?this.dateRange[1]:this.$store.state[this.moduleName].end;return e},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setEnd`,e)}},reverse:{get(){return this.$store.state[this.moduleName].reverse||!1},set(e){this.$store.commit(`${this.moduleName}/setReverse`,e)}},currentLimit:{get(){return this.$store.state[this.moduleName].limit},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setLimit`,e)}},selected:{get(){const e=this.$store.state[this.moduleName].selected;return e&&!e.length&&this.$emit("view-data",null),e},set(e){this.$store.commit(`${this.moduleName}/setSelected`,e),this.updateSelectedRoute(this.selectedMessagesTimestamps)}},selectedMessagesTimestamps(){let e;return this.selected.length&&(e=this.selected.map((e=>this.messages[e].timestamp))),e},loadingFlag(){const e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)},needAutoscroll(){return!this.selected.length&&this.autoscroll},routesFields(){const e=this.item.counters&&this.item.counters.filter((e=>"route"===e.type));return e||[]},panelActions(){return[{label:"Export CSV",icon:"mdi-file-document-outline",handler:()=>this.exportCsv({filter:`${this.filter}`,begin:Math.floor(this.begin/1e3),end:Math.floor(this.end/1e3)},{from:this.begin,to:this.end},"intervals"),condition:this.messages.length,tooltip:"Save messages to CSV",async:this.isFileCsvLoading}]},viewConfig(){return Object.assign(this.config.viewConfig,{needKeysProcess:!!this.selected.length})}},methods:{tableClickHandler(e){e.target.closest(".list-item--click-control")||(this.selected=[],this.$emit("action-view-data",{index:-1,content:[]}))},getItemsProps(e,t){const s=this.messages[e];t.key=s["x-flespi-message-key"],t.class="list-item list-item--click-control",t.props.etcVisible=this.etcVisible,t.props.actionsVisible=this.actionsVisible,t.props.selected=this.selected.includes(e),t.props.actions=()=>this.getItemPropsActions(s,t),t.props.highlighted=this.viewedInterval&&s.id===this.viewedInterval.id||this.interval&&s.begin>=this.interval.begin&&s.end<=this.interval.end,t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.viewMessagesAndShowInMessagesHandler,t.dataHandler=(e,t,s)=>(this.autoscroll=!1,this.listItem.methods.getValueOfProp(e.data,t.data))},getItemPropsActions(e,t){const s=this.selected.length>1?N["a"]:N["b"],i=[...this.config.actions.filter((e=>e.mode===s))];return s===N["b"]&&this.routesFields.some((t=>!!e[t.name]))&&i.push({icon:"mdi-map",label:"Show on map",classes:"",type:"map"}),i.push({icon:"mdi-function",label:"Test expression",classes:"",type:"expression"}),i},resetParams(){this.$refs.scrollList.resetParams()},processQuery(e){if(!this.isInit)return!1;try{e=e?JSON.parse(e):{};let t=!1;(!this.filter&&e.filter||this.filter&&!e.filter||this.filter&&e.filter&&this.filter!==e.filter)&&(this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.filter=e.filter||null,t=!0),t&&(this.$store.commit(`${this.moduleName}/clearMessages`),this.$store.dispatch(`${this.moduleName}/get`))}catch(t){}},scrollHandler({event:e,data:t}){const s=Math.floor(t.start+(t.end-t.start)/4),i=this.messages[s],a=i.timestamp;this.scrollTimestamp=a,this.debouncedUpdateMessagesRoute({},!0)},updateSelectedRoute(e){this.updateMessagesRoute({selected:e})},filterChangeHandler(e){this.filter!==e&&this.updateMessagesRoute({filter:e||void 0})},updateColsHandler(e){this.cols=e},refresh(){this.$emit("change:date-range",[this.begin,this.end]),this.viewedInterval=null,this.$store.commit(`${this.moduleName}/clearMessages`),this.$store.dispatch(`${this.moduleName}/get`)},dateRangeChange(e){const t=e[0],s=e[1];this.begin=t,this.end=s,this.$emit("change:date-range",e),this.viewedInterval=null,this.$store.commit(`${this.moduleName}/clearMessages`),this.$store.dispatch(`${this.moduleName}/get`)},dateRangeChangeHandler(e){const t=e[0],s=e[1];if(this.begin===t&&this.end===s)return!1;this.dateRangeChange(e)},actionHandler({index:e,type:t,content:s}){switch(this.selected.length>1&&(s=this.selected.map((e=>this.messages[e]))),t){case"view":this.itemClickHandler({index:e,content:s,entity:this.item});break;case"copy":this.copyMessageHandler({index:e,content:s,entity:this.item});break;case"expression":this.showExprTest(this.$store.state.token,this.cols.schemas[this.cols.activeSchema].cols,this.selected.map((e=>this.messages[e])));break;default:this.$emit(`action-${t}`,{index:e,content:[s],entity:this.item});break}},actionToBottomHandler(){this.autoscroll=!0,this.$refs.scrollList.scrollTo(this.messages.length-1)},viewMessagesAndShowInMessagesHandler({index:e,content:t,event:s}){this.itemClickHandler({index:e,content:t,entity:this.item,event:s}),1===this.selected.length?this.inMessagesHandler({index:e,content:t}):this.inMessagesHandler({index:e,content:void 0})},itemClickHandler({index:e,content:t,entity:s,event:i}){this.selected=this.multiselectProcess({index:e,event:i,selected:this.selected});const a=this.selected.map((e=>this.messages[e]));this.$emit("action-view-data",{index:e,content:a,entity:s})},inMessagesHandler({index:e,content:t}){this.viewedInterval=t,this.$emit("in-messages",this.viewedInterval)},copyMessageHandler({index:e,content:t}){Object(h["a"])(JSON.stringify(t)).then((e=>{this.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(e=>{this.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},unselect(){this.selected.length&&(this.viewedInterval=null,this.selected=[])},normalizeSelected(e){if(this.selected&&this.selected.length&&!this.viewedInterval){const t=this.selected[0];this.$emit("action-view-data",{index:t,content:e,entity:this.item})}},scrollTo(e){this.$nextTick((()=>this.$refs.scrollList&&this.$refs.scrollList.scrollTo(e)))},async showMessagesByInterval(){const e=this.interval;if(!e)return;const t=this.messages.findIndex((t=>t.begin===e.begin));if(-1!==t)this.scrollTo(t-1);else{this.$store.state[this.moduleName].messages=[];const t=await this.$store.dispatch(`${this.moduleName}/getMessages`,{from:e.begin,to:e.end+.999999,count:this.limit}),s=Math.ceil((this.limit-t.length)/2);let i=0;if(t.length<this.limit){ep;const a=await Promise.all([this.$store.dispatch(`${this.moduleName}/getMessages`,{from:this.from/1e3,to:e.begin-1e-6,count:s,reverse:!0}),this.$store.dispatch(`${this.moduleName}/getMessages`,{from:e.end+1,to:this.to/1e3,count:s})]),l=a[0].reverse(),n=a[1];t.splice(0,0,...l),i=l.length,t.splice(t.length,0,...n),await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`)}else await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`);this.scrollTo(i)}},nextSelect(){if(this.selected.length){const e=this.selected.slice(-1)[0],t=e+1,s=this.messages[t];if(s){this.selected=[t];const e=s;this.$emit("action-select",{index:t,content:[e],entity:this.item}),this.inMessagesHandler({index:t,content:e}),this.scrollTo(t)}}},prevSelect(){if(this.selected.length){const e=this.selected[0],t=e-1,s=this.messages[t];if(s){this.selected=[t];const e=s;this.$emit("action-select",{index:t,content:[e],entity:this.item}),this.inMessagesHandler({index:t,content:e}),this.scrollTo(t)}}},routeConfigProcess(e={}){const t={};try{e=JSON.parse(e)}catch(s){}return e.filter&&(t.filter=e.filter),e.scroll&&(this.scrollTimestamp=e.scroll,t.initTimestamp=e.scroll),e.selected&&(t.selected=e.selected,t.initTimestamp=e.selected[0]),t},async init(){if(this.$store.state[this.moduleName]?this.$store.commit(`${this.moduleName}/clear`):this.$store.registerModule(this.moduleName,Object(o["f"])({Vue:c["default"],LocalStorage:this.$q.localStorage,name:{name:this.isSecondary?"intervals":this.moduleName,lsNamespace:"flespi-toolbox-settings.cols"},errorHandler:e=>{this.$store.commit("reqFailed",e)}})),this.currentLimit=this.limit,this.activeId){this.$store.commit(`${this.moduleName}/setActive`,this.activeId);const e=this.item.counters||[];this.$store.dispatch(`${this.moduleName}/getCols`,e)}this.activeDeviceId&&this.$store.commit(`${this.moduleName}/setActiveDevice`,this.activeDeviceId);const e=1e3*this.$route.query.from,t=1e3*this.$route.query.to,s=this.$route.query[this.routeParamName];let{filter:i,initTimestamp:a,selected:l}=this.routeConfigProcess(s);if(this.filter=i,this.isSecondary?(this.begin=this.dateRange[0],this.end=this.dateRange[1],await this.$store.dispatch(`${this.moduleName}/get`)):(e&&t?(this.begin=e,this.end=t):await this.$store.dispatch(`${this.moduleName}/initTime`),this.$emit("change:date-range",[this.begin,this.end]),await this.$store.dispatch(`${this.moduleName}/get`),await this.$store.dispatch(`${this.moduleName}/pollingGet`)),a){const e=this.messages.findIndex((e=>e.timestamp===a));this.scrollTo(e)}this.initSelectedByTimestamps(l),this.updateMessagesRoute({},!0),this.isInit=!0},initSelectedByTimestamps(e){if(e){const{indexes:t,messages:s}=this.messages.reduce(((t,s,i)=>(e.includes(s.timestamp)&&(t.messages.push(s),t.indexes.push(i)),t)),{indexes:[],messages:[]});this.selected=t,this.$emit("action-view-data",{index:t[t.length-1],content:s,entity:this.item}),this.inMessagesHandler({content:s[0]})}},updateMessagesRoute(e={},t=!1){const s={filter:this.filter||void 0,scroll:this.scrollTimestamp,selected:this.selectedMessagesTimestamps,...e};this.updateRoute({query:{[this.routeParamName]:JSON.stringify(s)}},t)},arrowDownHandler(){const e=this.selected.slice(-1)[0]+1,t=this.messages[e];if(t){const s={type:"view",content:t,index:e};this.viewMessagesAndShowInMessagesHandler(s)}},arrowUpHandler(){const e=this.selected[0]-1,t=this.messages[e];if(t){const s={type:"view",content:t,index:e};this.viewMessagesAndShowInMessagesHandler(s)}}},watch:{activeId(e){this.active=e},activeDeviceId(e){this.activeDevice=e},limit(e){this.currentLimit=e},interval(){this.showMessagesByInterval()},dateRange(e){this.dateRangeChange(e)},$route(e){this.processRoute({[this.routeParamName]:this.processQuery},e)}},created(){this.debouncedUpdateMessagesRoute=d()(this.updateMessagesRoute,500,{trailing:!0,maxWait:1e3}),this.init(),this.offlineHandler=c["default"].connector.socket.on("offline",(()=>{this.$store.commit(`${this.moduleName}/setOffline`)})),this.connectHandler=c["default"].connector.socket.on("connect",(()=>{this.$store.state[this.moduleName].offline&&(this.$store.commit(`${this.moduleName}/setReconnected`),this.$store.commit(`${this.moduleName}/clearOfflineState`))}))},beforeDestroy(){this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),void 0!==this.offlineHandler&&c["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&c["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit(`${this.moduleName}/clear`),this.$store.commit(`${this.moduleName}/setActive`,null),this.$store.commit(`${this.moduleName}/setActiveDevice`,null)},mixins:[y["a"],C["a"],x["a"],I["a"]],components:{VirtualScrollList:o["b"],EmptyPane:w["a"]}},M=k,S=Object(f["a"])(M,l,n,!1,null,null,null),q=S.exports,_=function(){var e=this,t=e._self._c;return t("div",[t("virtual-scroll-list",{ref:"scrollList",class:{"non-selectable":e.selectionMode},attrs:{name:"IntervalsMessagesVirtualScroll",cols:e.cols,actions:e.actions,panelActions:e.panelActions,items:e.messages,dateRange:e.dateRange,viewConfig:e.viewConfig,filter:e.filter,theme:e.theme,title:"Messages",loading:e.loadingFlag,autoscroll:e.needAutoscroll,i18n:e.i18n,scrollOffset:"10%",item:e.listItem,itemprops:e.getItemsProps},on:{scroll:e.scrollHandler,action:e.actionHandler,"change-filter":e.filterChangeHandler,"scroll-top":e.paginationPrevChangeHandler,"scroll-bottom":e.paginationNextChangeHandler,"action-to-bottom":e.actionToBottomHandler,"update-cols":e.updateColsHandler,arrowup:e.arrowUpHandler,arrowdown:e.arrowDownHandler},nativeOn:{click:function(t){return e.tableClickHandler.apply(null,arguments)}}},[t("empty-pane",{attrs:{slot:"empty",config:e.config.emptyState},slot:"empty"})],1)],1)},H=[],W=function(){var e=this,t=e._self._c;return t("div",{style:{height:`${e.itemHeight}px`,width:`${e.rowWidth}px`},on:{click:t=>e.itemClickHandler(e.index,e.item,t)}},[t("div",{staticClass:"cursor-pointer",class:[e.item["x-flespi-status"]?"missed-items":"",e.highlighted?"bg-purple-9":"",e.selected?"bg-white-opasity":e.highlightLevel?`text-${e.highlightType}-${e.highlightLevel}`:""],style:{height:`${e.itemHeight}px`,width:`${e.rowWidth}px`,color:e.selected?"#333":""}},[e._l(e.cols,(function(s,i){return["etc"===s.__dest?t("span",{key:s.name+i,staticClass:"list__item item_etc",class:{[`item_${i}`]:!0,"item--active":e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i}},[e._v(e._s(e.values.etc.value||"*Empty*"))]):t("span",{key:s.name+i,staticClass:"list__item",class:{[`item_${i}`]:!0,"item--active":e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===i},attrs:{title:e.values[s.name].value}},[e._v("\n        "+e._s(e.values[s.name].value)+"\n      ")])]}))],2)])},A=[],R=s("f8fe"),T={props:["item","index","actions","cols","itemHeight","rowWidth","selected","highlighted","menuCellActive"],mixins:[R["a"]],data(){return{date:u["a"]}},computed:{values(){let e={};return e=this.cols.length?this.cols.reduce(((e,t,s,i)=>(e[t.name]={value:this.getValueOfProp(t,this.item)},s===i.length-1&&(e.etc={value:""}),e)),{}):{etc:{value:""}},Object.keys(this.item).forEach((t=>{e[t]||(-1!==t.indexOf("image.bin.")?e.etc.value+=`${t}: <binary image>`:e.etc.value+=`${t}: ${JSON.stringify(this.item[t])}; `)})),e}},methods:{clickHandler(e,t,s){this.$emit("action",{index:e,type:t,content:s})},itemClickHandler(e,t,s){this.$emit("item-click",{index:e,content:t,event:s})},getValueOfProp(e,t){const s=e.name;let i=t[s];return s.match(/timestamp$/)&&(i=u["a"].formatDate(1e3*i,"DD/MM/YYYY HH:mm:ss")),-1!==s.indexOf("image.bin.")&&i&&(i="<binary image>"),"string"!==typeof i&&(i=JSON.stringify(i)),i}}},D=T,O=(s("c6c1"),Object(f["a"])(D,W,A,!1,null,"6becaf51",null)),P=O.exports,V={props:["item","activeId","interval","dateRange","limit","config"],data(){return{listItem:P,theme:this.config.theme,actions:this.config.actions,autoscroll:!0,scrollTimestamp:void 0,moduleName:this.config.vuexModuleName,isInit:!1,i18n:{"Columns by schema":"Columns by protocol"}}},computed:{messages:{get(){const e=this.$store.state[this.moduleName].messages;return this.scrollControlling(e.length),e},set(e){this.$store.commit(`${this.moduleName}/setMessages`,e)}},intervals(){return this.$store.state[this.moduleName].messages},active:{get(){return this.$store.state[this.moduleName].active},async set(e){await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.$store.commit(`${this.moduleName}/setActive`,e),this.$store.commit(`${this.moduleName}/clearMessages`),await this.$store.dispatch(`${this.moduleName}/getCols`,{etc:!0}),await this.getMessages()}},cols:{get(){return this.$store.state[this.moduleName].cols},set(e){this.$store.commit(`${this.moduleName}/updateCols`,e)}},filter:{get(){return this.$store.state[this.moduleName].filter},set(e){e=e||"",this.$store.commit(`${this.moduleName}/setFilter`,e)}},from:{get(){return this.$store.state[this.moduleName].from},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setFrom`,e)}},to:{get(){return this.$store.state[this.moduleName].to},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setTo`,e)}},realtimeEnabled(){return this.$store.state[this.moduleName].realtimeEnabled},reverse:{get(){return this.$store.state[this.moduleName].reverse||!1},set(e){this.$store.commit(`${this.moduleName}/setReverse`,e)}},currentLimit:{get(){return this.$store.state[this.moduleName].limit},set(e){e=e||1e3,this.$store.commit(`${this.moduleName}/setLimit`,e)}},selected:{get(){return this.$store.state[this.moduleName].selected},set(e){e&&e.length&&(this.autoscroll=!1),this.$store.commit(`${this.moduleName}/setSelected`,e),this.updateSelectedRoute(this.selectedMessagesTimestamps)}},selectedMessagesTimestamps(){let e;return this.selected.length&&(e=this.selected.map((e=>this.messages[e].timestamp))),e},loadingFlag(){const e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)},needAutoscroll(){return this.realtimeEnabled&&!this.selected.length&&this.autoscroll},panelActions(){return[{label:"Export CSV",icon:"mdi-file-document-outline",handler:()=>this.exportCsv({filter:`${this.filter}`,from:this.from/1e3,to:this.to/1e3},{from:this.from,to:this.to},"devices"),condition:this.messages.length,tooltip:"Save messages to CSV",async:this.isFileCsvLoading}]},viewConfig(){return Object.assign(this.config.viewConfig,{needKeysProcess:!!this.selected.length})}},methods:{tableClickHandler(e){e.target.closest(".list-item--click-control")||(this.selected=[],this.$emit("action-view-data",{index:-1,content:[]}))},getItemsProps(e,t){const s=this.messages[e];t.key=s["x-flespi-message-key"],t.class="list-item list-item--click-control",t.props.etcVisible=this.etcVisible,t.props.actionsVisible=this.actionsVisible,t.props.selected=this.selected.includes(e),t.props.actions=()=>this.getItemPropsActions(s,t),t.props.highlighted=this.interval&&(s.timestamp>=this.interval.begin&&s.timestamp<=this.interval.end||s["timestamp.key"]>=this.interval.begin&&s["timestamp.key"]<=this.interval.end),t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.itemClickHandler,t.dataHandler=(e,t,s)=>(this.autoscroll=!1,this.listItem.methods.getValueOfProp(e.data,t.data))},getItemPropsActions(e,t){const s=this.selected.length>1?N["a"]:N["b"],i=[...this.config.actions.filter((e=>e.mode===s))];return s===N["b"]&&(e["position.latitude"]&&e["position.longitude"]&&i.push({icon:"mdi-map",label:"Show on map",classes:"",type:"map"}),Object.keys(e).some((t=>{const s=e[t]&&(e[t].toString().match(/^data:image\/(?:gif|png|jpeg|bmp|webp)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/)||0===t.indexOf("image.bin."));return s&&i.push({icon:"mdi-image-outline",label:"Show image",classes:"",type:"image"}),s}))),i.push({icon:"mdi-function",label:"Test expression",classes:"",type:"expression"}),i},scrollTo(e){this.$nextTick((()=>this.$refs.scrollList&&this.$refs.scrollList.scrollTo(e)))},scrollToWithSavePadding(e){this.$nextTick((()=>this.$refs.scrollList&&this.$refs.scrollList.scrollToWithSavePadding(e)))},scrollHandler({event:e,data:t}){const s=Math.floor(t.start+(t.end-t.start)/4),i=this.messages[s],a=i.timestamp;this.scrollTimestamp=a,this.debouncedUpdateMessagesRoute({},!0)},updateSelectedRoute(e){this.updateMessagesRoute({selected:e})},async getMessages(){this.to<=Date.now()?await this.$store.dispatch(`${this.moduleName}/get`):(await this.$store.dispatch(`${this.moduleName}/getHistory`,1e3),this.scrollTo(this.messages.length-1))},resetParams(){this.$refs.scrollList.resetParams()},processQuery(e){if(!this.isInit)return!1;try{e=e?JSON.parse(e):{};let t=!1;(!this.filter&&e.filter||this.filter&&!e.filter||this.filter&&e.filter&&this.filter!==e.filter)&&(this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.filter=e.filter||null,t=!0),t&&(this.$store.commit(`${this.moduleName}/clearMessages`),this.getMessages())}catch(t){}},filterChangeHandler(e){this.filter!==e&&this.updateMessagesRoute({filter:e||void 0})},updateColsHandler(e){this.cols=e},dateRangeChangeHandler(e){const t=e[0],s=e[1];if(this.from===t&&this.to===s)return!1;this.from=t,this.to=s,this.$store.commit(`${this.moduleName}/clearMessages`),this.getMessages()},paginationPrevChangeHandler(){this.$store.dispatch(`${this.moduleName}/getPrevPage`).then((e=>{e&&"number"===typeof e&&this.scrollToWithSavePadding(e)}))},paginationNextChangeHandler(){this.$store.dispatch(`${this.moduleName}/getNextPage`).then((e=>{this.autoscroll=!0,e&&"number"===typeof e&&this.scrollTo(this.messages.length-e)}))},async showMessagesByInterval(){const e=this.interval,t=this;if(!e)return;const s=this.messages.findIndex((t=>t.timestamp===e.begin));if(-1!==s)this.scrollTo(s-1);else{this.$store.state[this.moduleName].messages=[];const s=await this.$store.dispatch(`${this.moduleName}/getMessages`,{from:e.begin-180,to:e.end+180,count:this.limit}),i=Math.ceil((this.limit-s.length)/2);let a=0;if(s.length<this.limit){const t=await Promise.all([this.$store.dispatch(`${this.moduleName}/getMessages`,{from:this.from/1e3,to:e.begin-1e-6,count:i,reverse:!0}),this.$store.dispatch(`${this.moduleName}/getMessages`,{from:e.end+1e-6,to:this.to/1e3,count:i})]),l=t[0].reverse(),n=t[1];s.splice(0,0,...l),a=l.length,s.splice(s.length,0,...n),await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`)}else await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`);this.$store.state[this.moduleName].pages=[s.length],this.$store.commit(`${this.moduleName}/setHistoryMessages`,s),setTimeout((function(){const i=s.findIndex((t=>t.timestamp===e.begin||t["timestamp.key"]===e.begin));t.scrollTo(i||a||0)}),50)}},actionHandler({index:e,type:t,content:s}){switch(this.selected.length>1&&(s=this.selected.map((e=>this.messages[e]))),t){case"view":this.itemClickHandler({index:e,content:s});break;case"copy":this.copyMessageHandler({index:e,content:s});break;case"expression":this.showExprTest(this.$store.state.token,this.cols.schemas[this.cols.activeSchema].cols,this.selected.map((e=>this.messages[e])));break;default:this.$emit(`action-${t}`,{index:e,content:[s]});break}},itemClickHandler({index:e,content:t,event:s}){this.selected=this.multiselectProcess({index:e,event:s,selected:this.selected});const i=this.selected.map((e=>this.messages[e]));this.$emit("action-view-data",{index:e,content:i})},copyMessageHandler({index:e,content:t}){Object(h["a"])(JSON.stringify(t)).then((e=>{this.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(e=>{this.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},actionToBottomHandler(){this.realtimeEnabled?(this.autoscroll=!0,this.scrollTo(this.messages.length-1)):this.$store.dispatch(`${this.moduleName}/getHistory`,1e3).then((()=>{this.scrollTo(this.messages.length-1)}))},unselect(){this.selected.length&&(this.selected=[])},scrollControlling(e){this.selected.length&&this.selected[0]+1e3<=e&&this.$store.dispatch(`${this.moduleName}/unsubscribePooling`)},nextSelect(){if(this.selected.length){const e=this.selected.slice(-1)[0],t=e+1,s=this.messages[t];s&&(this.selected=[t],this.$emit("action-select",{index:t,content:[s]}),this.scrollTo(t))}},prevSelect(){if(this.selected.length){const e=this.selected[0],t=e-1,s=this.messages[t];s&&(this.selected=[t],this.$emit("action-select",{index:t,content:[s]}),this.scrollTo(t))}},async getMessagesStartedBy(e){e*=1e3;const t={from:e/1e3,to:e/1e3,filter:this.filter||void 0,count:this.currentLimit},s=await this.$store.dispatch(`${this.moduleName}/getMessages`,t),i={from:this.from/1e3,to:(e-.001)/1e3,reverse:!0,filter:this.filter||void 0,count:this.currentLimit/2-s.length},a={from:(e+.001)/1e3,to:this.to/1e3,filter:this.filter||void 0,count:this.currentLimit/2-s.length},l=await this.$store.dispatch(`${this.moduleName}/getMessages`,i),n=await this.$store.dispatch(`${this.moduleName}/getMessages`,a),o=[...l.reverse(),...s,...n];this.$store.commit(`${this.moduleName}/limiting`,{type:"init",count:o.length}),this.$store.commit(`${this.moduleName}/setHistoryMessages`,o);const c=l.length;this.scrollTo(c)},routeConfigProcess(e={}){const t={needInitMessages:!0};try{e=JSON.parse(e)}catch(s){}return e.filter&&(t.filter=e.filter),e.scroll&&(this.scrollTimestamp=e.scroll,t.initTimestamp=e.scroll),e.selected&&(t.selected=e.selected,t.initTimestamp=e.selected[0]),this.$route.query.intervals&&-1!==this.$route.query.intervals.indexOf("selected")&&(t.needInitMessages=!1),t},async init(){this.$store.state[this.moduleName]?this.$store.commit(`${this.moduleName}/clear`):this.$store.registerModule(this.moduleName,Object(o["e"])({Vue:c["default"],LocalStorage:this.$q.localStorage,name:{name:this.moduleName,lsNamespace:"flespi-toolbox-settings.cols"},errorHandler:e=>{this.$store.commit("reqFailed",e)}})),this.$store.commit(`${this.moduleName}/setSortBy`,"timestamp"),this.currentLimit=this.limit;let{filter:e,initTimestamp:t,selected:s,needInitMessages:i}=this.routeConfigProcess(this.$route.query.messages);this.filter=e,this.dateRangeChangeHandler(this.dateRange),this.$store.commit(`${this.moduleName}/setActive`,this.activeId),await this.$store.dispatch(`${this.moduleName}/getCols`,{etc:!0}),i&&(t?await this.getMessagesStartedBy(t):await this.getMessages(),this.initSelectedByTimestamps(s)),this.updateMessagesRoute({},!0),this.isInit=!0},initSelectedByTimestamps(e){if(e){const{indexes:t,messages:s}=this.messages.reduce(((t,s,i)=>(e.includes(s.timestamp)&&(t.messages.push(s),t.indexes.push(i)),t)),{indexes:[],messages:[]});this.selected=t,this.$emit("action-view-data",{index:t[t.length-1],content:s})}},updateMessagesRoute(e={},t=!1){const s={filter:this.filter||void 0,scroll:this.scrollTimestamp,selected:this.selectedMessagesTimestamps,...e};this.updateRoute({query:{messages:JSON.stringify(s)}},t)},arrowDownHandler(){const e=this.selected.slice(-1)[0]+1,t=this.messages[e];if(t){const s={type:"view",content:[t],index:e};this.actionHandler(s)}},arrowUpHandler(){const e=this.selected[0]-1,t=this.messages[e];if(t){const s={type:"view",content:[t],index:e};this.actionHandler(s)}}},watch:{activeId(e){this.active=e},limit(e){this.currentLimit=e},dateRange(e){this.dateRangeChangeHandler(e)},interval(){this.showMessagesByInterval()},$route(e){this.processRoute({messages:this.processQuery},e)}},created(){this.debouncedUpdateMessagesRoute=d()(this.updateMessagesRoute,500,{trailing:!0,maxWait:1e3}),this.init(),this.offlineHandler=c["default"].connector.socket.on("offline",(()=>{this.$store.commit(`${this.moduleName}/setOffline`)})),this.connectHandler=c["default"].connector.socket.on("connect",(()=>{this.$store.state[this.moduleName].offline&&(this.$store.commit(`${this.moduleName}/setReconnected`),this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/getMissedMessages`),this.$store.commit(`${this.moduleName}/clearOfflineState`))}))},beforeDestroy(){this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),void 0!==this.offlineHandler&&c["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&c["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit(`${this.moduleName}/clear`)},mixins:[y["a"],C["a"],x["a"],I["a"]],components:{VirtualScrollList:o["b"],EmptyPane:w["a"]}},L=V,E=Object(f["a"])(L,_,H,!1,null,null,null),B=E.exports,F=s("df1d"),j=s("6512"),Q=s("9b02"),z=s.n(Q),J=s("3a57"),Y=s("b57c"),U=s("0860"),G={data(){return{isWidgetsIntervalsActive:!1,widgetsViewedInterval:null}},computed:{fieldsIntervalsMetaData(){const e=z()(this.$refs,`${this.intervalsWidgetsRefName}.cols`,void 0),t=Object.values(e.enum),s=z()(this.$refs,`${this.intervalsWidgetsRefName}.$refs.scrollList.activeCols`,[]).reduce(((e,t)=>(e[t.name]={...t,display:!0},e)),{});let i={};return t&&(i=t.reduce(((e,t)=>(e[t.name]={...t,display:!!s[t.name]},e)),{}),i={...s,...i}),i},mapExtendConfig(){let e={};const t=z()(this.widgetsViewedInterval,"entity.selectors",void 0);return t&&(e=t.reduce(((e,t,s)=>"geofence"===t.type&&t.geofences&&0!==t.geofences.length?(t.geofences.forEach(((t,i)=>{const a=`${t.name||"NoName"}-${s}-${i}`;"circle"===t.type?(e.circles||(e.circles={}),e.circles[a]={center:t.center,radius:1e3*t.radius}):"corridor"===t.type?(e.corridors||(e.corridors={}),e.corridors[a]={path:t.path,width:1e3*t.width}):"polygon"===t.type&&(e.polygons||(e.polygons={}),e.polygons[a]={path:t.path})})),e):e),{})),e},intervalsWidgetsViewConfig(){const e={};if(this.widgetsViewedInterval){const t=this.widgetsViewedInterval.content,s=this.widgetsViewedInterval.entity,i=s.counters&&s.counters.filter((e=>"route"===e.type&&t[e.name])).length;i&&(e.track={title:"Track",wrapper:U["a"]});const a=`${t.ident?`<div style="font-size: 1.1rem">${t.ident}</div>`:""}${t.timestamp?`<div style="font-size: .8rem">${u["a"].formatDate(1e3*t.timestamp,"DD/MM/YYYY HH:mm:ss (Z)")}</div>`:""}`;e.message={title:"JSON",description:a,wrapper:J["a"],item:t},e.object={title:"Fields",description:a,wrapper:Y["a"],item:t,meta:this.fieldsIntervalsMetaData,action:this.intervalsWidgetActionHandler}}return e},intervalsWidgetsRefName(){return z()(this.widgetsViewedInterval,"refName")}},methods:{setWidgetsIntervalView({content:e,entity:t,refName:s}){this.widgetsViewedInterval={content:{...e},entity:t,refName:s};const i=t.counters&&t.counters.filter((e=>"route"===e.type)),a=Object.keys(e).reduce(((t,s)=>(i.filter((e=>e.name===s)).length&&t.push(e[s]),t)),[]);this.isWidgetsIntervalsActive||(this.beforeEnableWidgetByPane&&this.beforeEnableWidgetByPane("intervals"),this.isWidgetsIntervalsActive=!0),this.$nextTick((()=>{const e=this.$refs.intervalsView.ref("track");e&&(e.clear(),this.mapExtendConfig&&e.addConfig(this.mapExtendConfig),e.autobounds(!0).addRoutes(a).send())})),this.activateWidgetWindow("intervalsView")},intervalWidgetsActions(e,t){if(Array.isArray(t.content)&&1!==t.content.length)return this.isWidgetsIntervalsActive=!1,!1;t.content=t.content[0];const s=this.isWidgetsIntervalsActive;this.setWidgetsIntervalView(t);const i=this.$refs.intervalsView;switch(e){case"track":i.setTab(e);break;case"show":i.setTab("message");break;case"object":s||i.setTab("object");break;case"select":break}},closeIntervalsWidgetsHandler(){this.$refs[this.intervalsWidgetsRefName]&&this.$refs[this.intervalsWidgetsRefName].unselect()},nextWidgetsInterval(){this.$refs[this.intervalsWidgetsRefName].nextSelect()},prevWidgetsInterval(){this.$refs[this.intervalsWidgetsRefName].prevSelect()},intervalsWidgetActionHandler({type:e,data:t}){const s=z()(this.$refs[this.intervalsWidgetsRefName].$refs,"scrollList",void 0);if(s)switch(e){case"col-add":s.addCustomColumnHandler(t);break;case"col-remove":s.removeCustomColumnHandler(t);break}}},created(){this.$watch("mapExtendConfig",(e=>{const t=this.$refs.intervalsView.ref("track");t&&(t.clear(["polygons","circles","corridors"]),t.addConfig(e),t.send())})),this.$watch("widgetsViewedInterval.refName",((e,t)=>{e!==t&&t&&(this.$refs[t].unselect(),0===e.indexOf("related")&&(this.viewedInterval=null))}))}},K=s("5c16"),Z=s("2f62"),X=s("286e");const ee=!1,te=!0;var se={props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config","settings"],mixins:[X["a"],F["a"],j["a"],G,C["a"]],data(){const e=1e3*this.$route.query.from,t=1e3*this.$route.query.to;return{entityName:"intervals",calcFilter:"",deviceFilter:"",active:null,activeCalcId:null,ratio:50,isInit:!1,isItemsInit:!1,isDevicesInit:!1,isCalcsInit:!1,deviceBlocked:!1,calcsBlocked:!1,viewedInterval:null,dateRange:[e,t],blocked:"",relatedDataMode:ee,prevRoute:null,prevEntity:null}},computed:{...Object(Z["d"])({tokenType(e){return e.tokenInfo&&e.tokenInfo.access?e.tokenInfo.access.type:-1},devicesCollection(e){return e.devices||{}},tasksCollection(e){return e.tasks||{}},calcsCollection(e){return e.calcs||{}},sessionSettings(e){return e.sessionSettings}}),devices(){return Object.values(this.devicesCollection)},tasks(){const e=Object.values(this.tasksCollection);return e},calcs(){return Object.values(this.calcsCollection)},selectedDevice(){return this.devicesCollection[this.active]||{}},selectedCalc(){return this.calcsCollection[this.activeCalcId]||{}},relatedCalcId(){const e=this.selectedCalc.messages_source||{};let t=!1;return"calc"===e.source&&(t=e.calc_id),t},relatedCalc(){return this.relatedCalcId&&!this.isCalcsInit&&this.itemsLoad("calcs",void 0,this.activeCalcId,(()=>{this.isCalcsInit=!0})),this.calcsCollection[this.relatedCalcId]||{}},filteredDevices(){let e=this.devices;const t=this.tasks.map((e=>e.device_id));return e=e.filter((e=>t.includes(e.id))),this.filterItems(e,this.deviceFilter.toLowerCase())},filteredCalcs(){let e=this.calcs;return e=this.active?e.filter((e=>this.tasks.some((t=>this.active===t.device_id&&e.id===t.calc_id)))):e,this.filterItems(e,this.calcFilter.toLowerCase())},devicesSelectorDisabled(){return!this.isNeedSelect||"string"===typeof isNeedSelect&&this.isNeedSelect.indexOf("devices")>-1||this.deviceBlocked},calcsSelectorDisabled(){return!this.isNeedSelect||"string"===typeof isNeedSelect&&this.isNeedSelect.indexOf("calcs")>-1||this.calcsBlocked},size(){return[this.ratio,100-this.ratio]},hasActiveActions(){return this.actions.reduce(((e,t)=>e||t&&t.condition),!1)},actions(){return[{label:"Sync intervals",icon:"mdi-table-sync",handler:this.recalculateIntervals,condition:!!this.active&&!!this.activeCalcId,desc:"Recalculate intervals for selected period"},{label:this.relatedDataMode?"Messages":"Intervals",icon:this.relatedDataMode?"mdi-card-text-outline":"mdi-card-bulleted-outline",handler:()=>this.updateRoute({name:`${this.entityName}`,query:{related:this.relatedDataMode?"messages":"intervals"}}),condition:this.relatedCalcId,desc:"Switch related data between messages/intervals"},{label:"Devices",icon:"mdi-developer-board",handler:this.goBackDevice,condition:!!this.active&&(!0===this.isNeedSelect||"string"===typeof this.isNeedSelect&&this.isNeedSelect.indexOf("devices")>-1)},{label:"Calcs",icon:"mdi-calculator-variant",handler:this.goBackCalc,condition:!!this.activeCalcId&&(!0===this.isNeedSelect||"string"===typeof this.isNeedSelect&&this.isNeedSelect.indexOf("calcs")>-1)}]},panelsWidgetsStyle(){const e={},t=this.isWidgetsMessageActive||this.isWidgetsIntervalsActive,s=this.widgetStyle.left&&this.widgetStyle.right&&t,i=this.widgetStyle.left&&t,a=this.widgetStyle.right&&t;return s?(e.maxWidth="calc(100% - 600px)",e.left="400px"):(i||a)&&(e.maxWidth="calc(100% - 400px)",a&&(e.left="400px")),e}},methods:{filterItems(e,t){const s=t?e.filter((e=>e&&"undefined"!==typeof e.name&&null!==e.name&&e.name.toLowerCase().indexOf(t)>=0||e&&"undefined"!==typeof e.id&&null!==e.id&&(e.id+"").indexOf(t)>=0)):e;return s.sort(((e,t)=>{if(!e.name)return-1;if(!t.name)return 1;const s=e.name.toLowerCase(),i=t.name.toLowerCase();return s<i?-1:1})),s},...Object(Z["b"])(["getDeleted"]),...Object(Z["c"])(["setToolboxSessionSettings"]),filterDevicesSelectItems(e,t){this.isDevicesInit?t():this.itemsLoad("devices",t,this.active,(()=>{this.isDevicesInit=!0}))},filterCalcsSelectItems(e,t){this.isCalcsInit?t():this.itemsLoad("calcs",t,this.activeCalcId,(()=>{this.isCalcsInit=!0}))},onMapHandler(e){if(!this.isVisibleMap)return this.openMapHandler(),this.$nextTick((()=>{this.$refs.map.clear().addRoutes(e).send()})),!1;this.$refs.map&&this.isVisibleMap&&this.$refs.map.clear().addRoutes(e).send()},unselect(){this.$refs.intervals.unselect(),this.$refs.messages&&this.$refs.messages.unselect(),this.$refs.relatedIntervals&&this.$refs.relatedIntervals.unselect(),this.viewedInterval=null},setActive(e){e&&this.updateRoute({name:`${this.entityName}`,params:{deviceId:e,calcId:this.activeCalcId}},!this.active)},setActiveCalc(e){e&&this.updateRoute({name:`${this.entityName}`,params:{calcId:e,deviceId:this.active}},!this.activeCalcId)},clearActive(){this.setActive(null)},clearActiveCalc(){this.setActiveCalc(null)},recalculateIntervals(){this.$q.dialog({title:"Warning!",message:"Recalculate intervals for selected period?",color:"white",class:"text-white bg-red",cancel:!0,ok:"Recalculate",noRouteDismiss:!0}).onOk((async()=>{if(2===this.dateRange.length){const e={from:this.dateRange[0]/1e3,to:this.dateRange[1]/1e3};await c["default"].connector.http.post(`/gw/calcs/${this.activeCalcId}/devices/${this.active}/recalculate`,e).then((e=>{}),(e=>{})),setTimeout((()=>this.$refs.intervals.refresh()),1e3)}}))},goBackDevice(){"devices"===this.prevEntity&&this.prevRoute&&this.prevRoute.params.id===this.active?this.$router.push(this.prevRoute).catch((e=>e)):this.$router.push(`/devices/${this.active}`).catch((e=>e))},goBackCalc(){"calcs"===this.prevEntity&&this.prevRoute&&this.prevRoute.params.id===this.activeCalcId?this.$router.push(this.prevRoute).catch((e=>e)):this.$router.push(`/calcs/${this.activeCalcId}`).catch((e=>e))},init(){this.blocked=this.$route.query.noselect||"";const e=this.$route.params&&this.$route.params.deviceId?Number(this.$route.params.deviceId):null,t=this.$route.params&&this.$route.params.calcId?Number(this.$route.params.calcId):null,s=this.$route.query.related;s&&("messages"===s?this.relatedDataMode=ee:"intervals"===s&&(this.relatedDataMode=te)),e&&(this.active=e),t&&(this.activeCalcId=t),this.isInit=!0,this.updateRoute({name:`${this.entityName}`,params:{deviceId:this.active,calcId:this.activeCalcId},query:{related:this.relatedDataMode?"intervals":"messages"}},!0),this.$emit("inited")},clearWidgetsState(){this.isWidgetsMessageActive=!1,this.isWidgetsIntervalsActive=!1,this.activeWidgetWindow=void 0,this.widgetsViewedMessage=null,this.widgetsVieweInterval=null},beforeEnableWidgetByPane(e){switch(this.widgetStyle.left||this.isWidgetsMessageActive||this.isWidgetsIntervalsActive||this.widgetsViewModel.data||this.$nextTick((()=>this.widgetsChangeViewModelHandler(this.entityName,"data",{type:"minimized",to:"left"}))),e){case"messages":this.isWidgetsIntervalsActive=!1;break;case"intervals":this.isWidgetsMessageActive=!1,this.closeMessageWidgetsHandler();break}},onResizePage(e){this.$refs.intervalsView.resize(e),this.$refs.messagesView.resize(e)},changeRelatedDataMode(e){if(e="intervals"===e,e===this.relatedDataMode)return!1;this.unselect(),this.isWidgetsMessageActive&&(this.isWidgetsMessageActive=!1),this.isWidgetsIntervalsActive&&0===this.widgetsViewedInterval.refName.indexOf("related")&&(this.isWidgetsIntervalsActive=!1),this.relatedDataMode=!this.relatedDataMode},changeNoSelectMode(e){"calcs"===e||!e&&this.calcs.length?(this.deviceBlocked=!1,this.calcsBlocked=!0):"devices"===e||!e&&this.devices.length?(this.deviceBlocked=!0,this.calcsBlocked=!1):(this.deviceBlocked=!1,this.calcsBlocked=!0)},dateRangeChange(e){this.viewedInterval=null,this.updateRoute({query:{from:e[0]/1e3,to:e[1]/1e3}})}},created(){this.sessionSettings&&this.sessionSettings.intervalDevicesBlocked&&(this.deviceBlocked=!0),this.sessionSettings&&this.sessionSettings.intervalCalcsBlocked&&(this.calcsBlocked=!0)},beforeDestroy(){this.setToolboxSessionSettings({intervalDevicesBlocked:void 0,intervalCalcsBlocked:void 0})},beforeRouteEnter(e,t,s){s((s=>{t.meta.moduleName!==e.meta.moduleName&&(s.prevRoute=t,s.prevEntity=t.meta.moduleName)}))},watch:{$route(e){this.processRoute({related:e=>{this.changeRelatedDataMode(e)},noselect:e=>{this.changeNoSelectMode(e)}},e);const t=1e3*e.query.from,s=1e3*e.query.to;if(this.dateRange[0]===t&&this.dateRange[1]===s||(this.dateRange=[t,s]),e.params&&e.params.deviceId&&Number(e.params.deviceId)===this.active&&e.params.calcId&&this.activeCalcId===Number(e.params.calcId))return!1;if(e.params&&e.params.deviceId){const t=Number(e.params.deviceId);if(this.devicesCollection[t]){t!==this.active&&(this.active=t);const s=Number(e.params.calcId);e.params&&e.params.calcId&&this.calcsCollection[s]&&(this.activeCalcId=s)}else this.isInit&&(this.active=null)}else e.params&&!e.params.deviceId&&(this.active=null);this.clearWidgetsState()}},components:{intervals:q,messages:B,Widgets:K["a"]}},ie=se,ae=(s("0339"),s("9989")),le=s("3980"),ne=s("65c6"),oe=s("ddd8"),ce=s("27f9"),re=s("0016"),de=s("66e5"),he=s("4074"),me=s("0170"),ge=s("9c40"),ue=s("05c0"),pe=s("4e73"),ve=s("1c1c"),fe=s("8572"),$e=s("7f67"),be=s("eebe"),we=s.n(be),ye=Object(f["a"])(ie,i,a,!1,null,null,null);t["default"]=ye.exports;we()(ye,"components",{QPage:ae["a"],QResizeObserver:le["a"],QToolbar:ne["a"],QSelect:oe["a"],QInput:ce["a"],QIcon:re["a"],QItem:de["a"],QItemSection:he["a"],QItemLabel:me["a"],QBtn:ge["a"],QTooltip:ue["a"],QMenu:pe["a"],QList:ve["a"],QField:fe["a"]}),we()(ye,"directives",{ClosePopup:$e["a"]})},"3a59":function(e,t,s){"use strict";s("5ef3")},"5ef3":function(e,t,s){},c527:function(e,t,s){},c6c1:function(e,t,s){"use strict";s("c527")},f02f:function(e,t,s){}}]);
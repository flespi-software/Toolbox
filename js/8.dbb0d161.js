(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"63c9":function(e,t,i){},9633:function(e,t,i){},c4c9:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[i("q-resize-observer",{on:{resize:e.onResizePage}}),i("entities-toolbar",{attrs:{item:e.selectedItem,ratio:e.ratio,actions:e.actions},on:{"change-ratio":e.changeRatioHandler}},[i("div",{staticClass:"flex",class:{"middle-modificator":!e.active},attrs:{slot:"selects"},slot:"selects"},[i("q-select",{ref:"itemSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.active},attrs:{value:e.active,options:e.filteredItems,filled:"",loading:e.isItemsInitStart&&!e.isItemsInit,"hide-dropdown-icon":!e.isNeedSelect||"string"===typeof e.isNeedSelect&&e.isNeedSelect.indexOf("devices")>-1,label:e.active?"Device":"SELECT DEVICE",dark:"","hide-bottom-space":"",dense:"",color:"white",disable:!e.isNeedSelect||"string"===typeof e.isNeedSelect&&e.isNeedSelect.indexOf("devices")>-1,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredItems.length>6?6:e.filteredItems.length)+(e.needShowGetDeletedAction&&1===e.tokenType?77:48)+(e.filteredItems.length?0:4)+"px"}},on:{filter:function(t,i){return e.filterItems(e.entityName,t,i)}},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("div",{staticStyle:{"min-height":"77px"}},[i("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),i("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(t){return[e.selectedItem?i("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedItem.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-white ellipsis",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(e.selectedItem.configuration&&e.selectedItem.configuration.ident?e.selectedItem.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{staticClass:"text-white",attrs:{side:""}},[e.selectedItem.deleted?i("q-item-label",{staticClass:"q-pa-none text-right"},[i("small",{staticClass:"cheap-modifier"},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[i("small",[e._v("#"+e._s(e.selectedItem.id))])])],1)],1):e._e()]}},{key:"option",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":t.opt.deleted},attrs:{clickable:""},on:{click:function(i){e.active=t.opt.id}}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(t.opt.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(t.opt.configuration&&t.opt.configuration.ident?t.opt.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{attrs:{side:""}},[t.opt.deleted?i("q-item-label",{staticClass:"q-pa-xs text-right"},[i("small",{staticClass:"cheap-modifier cheap-modifier--item",class:{"cheap-modifier--mobile":e.$q.platform.is.mobile}},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[i("small",[e._v("#"+e._s(t.opt.id))])])],1)],1)]}}])},[i("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[i("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.needShowGetDeletedAction&&1===e.tokenType?i("div",{staticClass:"select__get-deleted",attrs:{slot:"after-options"},slot:"after-options"},[i("q-btn",{staticClass:"deleted-action",attrs:{icon:"mdi-download"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.getDeletedHandler.apply(null,arguments)}}},[e._v("see deleted")])],1):e._e()]),e.$q.platform.is.desktop&&e.selectedItem&&!e.selectedItem.deleted?i("transition",{attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[e.trafficRoute?i("q-btn",{staticClass:"on-right pull-right text-center rounded-borders q-px-xs q-py-none text-white",staticStyle:{width:"50px"},attrs:{title:"Traffic hex payload",flat:"",dense:""},on:{click:e.trafficViewHandler}},[i("q-icon",{attrs:{size:"1.5rem",color:"white",name:"mdi-download-network-outline"}}),i("div",{staticStyle:{"font-size":".7rem","line-height":".7rem"}},[e._v("Traffic")])],1):e._e()],1):e._e()],1)]),e.isInit&&e.active?i("div",[+e.size[0]?i("logs",{ref:"logs",style:[{height:"calc("+e.size[0]+"vh - "+(+e.size[1]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},e.panelsWidgetsStyle],attrs:{item:e.selectedItem,limit:e.limit,originPattern:"gw/devices/:id","entity-name":e.entityName,isEnabled:!!+e.size[0],config:e.logsConfig},on:{"view-log-message":e.viewWidgetsLogHandler,"action-select":function(t){return e.widgetsViewedLog=t.content},"to-traffic":e.toTrafficHandler}}):e._e(),+e.size[1]?i("messages",{ref:"messages",style:[{height:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},e.panelsWidgetsStyle],attrs:{item:e.selectedItem,activeId:e.active,isEnabled:!!+e.size[1],needRestoreSettings:e.needRestoreSettings,limit:e.limit,config:e.messagesConfig},on:{"action-view-data":function(t){e.messageWidgetsActions("object",t),e.addWidgetTrackMarker("track",t)},"action-map":function(t){return e.messageWidgetsActions("position",t)},"action-show":function(t){return e.messageWidgetsActions("show",t)},"action-image":function(t){return e.messageWidgetsActions("image",t)},"action-select":function(t){return e.messageWidgetsActions("select",t)},"action-traffic":function(t){return e.messageWidgetsActions("traffic",t)}}}):e._e()],1):e._e(),!e.items.length&&e.isItemsInit?i("div",{staticClass:"text-center text-grey-3 q-mt-lg"},[i("div",{staticStyle:{"font-size":"2rem"}},[e._v(e._s(e.isLoading?"Fetching data..":"Devices not found"))]),!e.isLoading&&e.needShowGetDeletedAction&&1===e.tokenType?i("q-btn",{staticClass:"q-mt-sm",attrs:{icon:"mdi-download",label:"see deleted"},on:{click:e.getDeletedHandler}}):e._e()],1):e._e(),i("widgets",{ref:"messagesView",attrs:{active:"messagesView"===e.activeWidgetWindow,config:e.messageWidgetsViewConfig,actions:e.widgetsHandleActions,controls:e.widgetWindowControls,"view-model":e.widgetsViewModel.data},on:{"change-view-model":function(t){return e.widgetsChangeViewModelHandler(e.entityName,"data",t)},active:function(t){return e.activateWidgetWindow("messagesView")},close:e.closeMessageWidgetsHandler,next:e.nextWidgetsMessage,prev:e.prevWidgetsMessage},model:{value:e.isWidgetsMessageActive,callback:function(t){e.isWidgetsMessageActive=t},expression:"isWidgetsMessageActive"}}),i("widgets",{ref:"logsView",attrs:{active:"logsView"===e.activeWidgetWindow,config:e.logsWidgetsViewConfig,actions:e.widgetsHandleActions,controls:e.widgetWindowControls,"view-model":e.widgetsViewModel.data},on:{"change-view-model":function(t){return e.widgetsChangeViewModelHandler(e.entityName,"data",t)},active:function(t){return e.activateWidgetWindow("logsView")},close:e.closeLogsWidgetsHandler,next:e.nextWidgetLog,prev:e.prevWidgetLog},model:{value:e.isWidgetsLogsActive,callback:function(t){e.isWidgetsLogsActive=t},expression:"isWidgetsLogsActive"}}),i("widgets",{ref:"track",attrs:{active:"track"===e.activeWidgetWindow,config:e.trackWidgetConfig,controls:e.widgetWindowControls,"view-model":e.widgetsViewModel.track},on:{"change-view-model":function(t){return e.widgetsChangeViewModelHandler(e.entityName,"track",t)},active:function(t){return e.activateWidgetWindow("track")},close:e.closeWidgetsHandler},model:{value:e.isWidgetsTrackActive,callback:function(t){e.isWidgetsTrackActive=t},expression:"isWidgetsTrackActive"}})],1)},a=[],o=i("ded3"),n=i.n(o),l=(i("4e82"),i("2ce0")),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.config.actions,panelActions:e.panelActions,items:e.messages,dateRange:e.dateRange,viewConfig:e.config.viewConfig,filter:e.filter,theme:e.config.theme,title:"Messages",loading:e.loadingFlag,autoscroll:e.needAutoscroll,scrollOffset:"10%",item:e.listItem,i18n:e.i18n,itemprops:e.getItemsProps,"has-new-messages":e.hasNewMessages},on:{action:e.actionHandler,"change-filter":e.filterChangeHandler,"scroll-top":e.paginationPrevChangeHandler,"scroll-bottom":e.paginationNextChangeHandler,"change-date-range":e.dateRangeChangeHandler,"action-to-bottom":e.actionToBottomHandler,"update-cols":e.updateColsHandler,"action-to-new-messages":e.actionToNewMessages,"action-to-new-messages-hide":e.actionToNewMessagesHide}},[i("empty-pane",{attrs:{slot:"empty",config:e.config.emptyState},slot:"empty"})],1)],1)},c=[],d=(i("26e9"),i("ddb0"),i("13d5"),i("de45")),m=i("2b0e"),h=i("cdde"),g=i("121a"),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px"},on:{click:function(t){return e.itemClickHandler(e.index,e.clearItem)}}},[i("div",{staticClass:"cursor-pointer",class:[e.item["x-flespi-status"]?"missed-items":"",e.selected?"bg-white-opasity":e.highlightLevel?"text-"+e.highlightType+"-"+e.highlightLevel:""],style:{height:e.itemHeight+"px",width:e.rowWidth+"px",color:e.selected?"#333":""}},[e._l(e.cols,(function(t,s){var a,o;return["etc"===t.__dest?i("span",{key:t.name+s,staticClass:"list__item item_etc",class:(a={},a["item_"+s]=!0,a["item--active"]=e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===s,a)},[e._v(e._s(e.values.etc.value||"*Empty*"))]):i("span",{key:t.name+s,staticClass:"list__item",class:(o={},o["item_"+s]=!0,o["item--active"]=e.menuCellActive&&e.menuCellActive.row===e.index&&e.menuCellActive.col===s,o),attrs:{title:e.values[t.name].value}},[e._v("\n        "+e._s(e.values[t.name].value)+"\n      ")])]}))],2)])},f=[],p=i("bd4c"),v={props:["item","index","actions","cols","itemHeight","rowWidth","selected","menuCellActive"],data(){let e=0,t="";return this.item.timestamp<this.item["server.timestamp"]-1800?(t="grey",e=7):this.item.timestamp<this.item["server.timestamp"]-600?(t="grey",e=6):this.item.timestamp<this.item["server.timestamp"]-120?(t="grey",e=5):this.item.timestamp-1800>this.item["server.timestamp"]?(t="orange",e=10):this.item.timestamp-60>this.item["server.timestamp"]?(t="orange",e=7):this.item.timestamp-1>this.item["server.timestamp"]&&(t="orange",e=4),{highlightType:t,highlightLevel:e,date:p["a"]}},computed:{values(){let e={};return e=this.cols.length?this.cols.reduce(((e,t,i,s)=>(e[t.name]={value:this.getValueOfProp(t,this.item)},i===s.length-1&&(e.etc={value:""}),e)),{}):{etc:{value:""}},Object.keys(this.item).forEach((t=>{if(!e[t]){if(-1!==t.indexOf("x-flespi"))return!1;-1!==t.indexOf("image.bin.")?e.etc.value+=`${t}: <binary image>`:e.etc.value+=`${t}: ${JSON.stringify(this.item[t])}; `}})),e},clearItem(){return Object.keys(this.item).reduce(((e,t)=>(-1!==t.indexOf("x-flespi")||(e[t]=this.item[t]),e)),{})}},methods:{clickHandler(e,t,i){this.$emit("action",{index:e,type:t,content:i})},itemClickHandler(e,t){this.$emit("item-click",{index:e,content:t})},getValueOfProp(e,t){const i=e.name;let s=t[i];return i.match(/timestamp$/)?s=p["a"].formatDate(1e3*s,"DD/MM/YYYY HH:mm:ss"):-1!==i.indexOf("image.bin.")?s="<binary image>":"string"!==typeof s&&(s=JSON.stringify(s)),s}}},w=v,$=(i("f229"),i("2877")),b=Object($["a"])(w,u,f,!1,null,"ba4e9e46",null),y=b.exports,x=i("9b02"),k=i.n(x),N=i("0463"),M={props:["item","activeId","limit","config","needRestoreSettings"],data(){return{listItem:y,moduleName:this.config.vuexModuleName,autoscroll:!0,i18n:{"Columns by schema":"Columns by protocol"}}},computed:{messages:{get(){const e=this.$store.state[this.moduleName].messages;return this.scrollControlling(e.length),e},set(e){this.$store.commit(`${this.moduleName}/setMessages`,e)}},active:{get(){return this.$store.state[this.moduleName].active},async set(e){await this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.$store.commit(`${this.moduleName}/setActive`,e),this.$store.commit(`${this.moduleName}/clearMessages`),await this.$store.dispatch(`${this.moduleName}/getCols`,{etc:!0}),await this.$store.dispatch(`${this.moduleName}/initTime`),await this.getMessages()}},panelActions(){return[{label:"Export CSV",icon:"mdi-file-document-outline",handler:this.exportCsv,condition:this.messages.length,tooltip:"Save messages to CSV",async:this.isFileCsvLoading}]},cols:{get(){return this.$store.state[this.moduleName].cols},set(e){this.$store.commit(`${this.moduleName}/updateCols`,e)}},filter:{get(){return this.$store.state[this.moduleName].filter},set(e){e=e||"",this.$store.commit(`${this.moduleName}/setFilter`,e)}},from:{get(){return this.$store.state[this.moduleName].from},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setFrom`,e)}},to:{get(){return this.$store.state[this.moduleName].to},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setTo`,e)}},dateRange(){return[this.$store.state[this.moduleName].from,this.$store.state[this.moduleName].to]},realtimeEnabled(){return this.$store.state[this.moduleName].realtimeEnabled},reverse:{get(){return this.$store.state[this.moduleName].reverse||!1},set(e){this.$store.commit(`${this.moduleName}/setReverse`,e)}},currentLimit:{get(){return this.$store.state[this.moduleName].limit},set(e){e=e||1e3,this.$store.commit(`${this.moduleName}/setLimit`,e)}},selected:{get(){return this.$store.state[this.moduleName].selected},set(e){e&&e.length&&(this.autoscroll=!1),this.$store.commit(`${this.moduleName}/setSelected`,e)}},hasNewMessages:{get(){return this.$store.state[this.moduleName].hasNewMessages},set(e){this.$store.state[this.moduleName].hasNewMessages=e}},loadingFlag(){const e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)},needAutoscroll(){return this.realtimeEnabled&&!this.selected.length&&this.autoscroll}},methods:{getItemsProps(e,t){const i=this.messages[e];t.key=i["x-flespi-message-key"],t.props.etcVisible=this.etcVisible,t.props.actionsVisible=this.actionsVisible,t.props.selected=this.selected.includes(e),i["position.latitude"]&&i["position.longitude"]&&(t.props.actions=[...t.props.actions,{icon:"mdi-map",label:"Show on map",classes:"",type:"map"}]),Object.keys(i).some((e=>{const s=i[e]&&(i[e].toString().match(/^data:image\/(?:gif|png|jpeg|bmp|webp)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/)||0===e.indexOf("image.bin."));return s&&(t.props.actions=[...t.props.actions,{icon:"mdi-image-outline",label:"Show image",classes:"",type:"image"}]),s})),t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.viewMessagesHandler,t.dataHandler=(e,t,i)=>(this.autoscroll=!1,this.listItem.methods.getValueOfProp(e.data,t.data))},scrollTo(e){this.$nextTick((()=>this.$refs.scrollList&&this.$refs.scrollList.scrollTo(e)))},scrollToWithSavePadding(e){this.$nextTick((()=>this.$refs.scrollList&&this.$refs.scrollList.scrollToWithSavePadding(e)))},async getMessages(){this.to<=Date.now()?await this.$store.dispatch(`${this.moduleName}/get`):(await this.$store.dispatch(`${this.moduleName}/getHistory`,1e3),this.scrollTo(this.messages.length-1))},resetParams(){this.$refs.scrollList.resetParams()},filterChangeHandler(e){this.filter!==e&&(this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),this.filter=e,this.$store.commit(`${this.moduleName}/clearMessages`),this.getMessages())},updateColsHandler(e){this.cols=e},dateRangeChangeHandler(e){const t=e[0],i=e[1];if(this.from===t&&this.to===i)return!1;this.from=t,this.to=i,this.$store.commit(`${this.moduleName}/clearMessages`),this.$store.dispatch(`${this.moduleName}/get`).then((()=>this.scrollTo(0)))},paginationPrevChangeHandler(){this.$store.dispatch(`${this.moduleName}/getPrevPage`).then((e=>{e&&"number"===typeof e&&this.scrollToWithSavePadding(e)}))},paginationNextChangeHandler(){this.$store.dispatch(`${this.moduleName}/getNextPage`).then((e=>{this.autoscroll=!0,e&&"number"===typeof e&&this.scrollTo(this.messages.length-e)}))},actionHandler({index:e,type:t,content:i}){switch(this.selected=[e],t){case"view":this.viewMessagesHandler({index:e,content:i});break;case"copy":this.copyMessageHandler({index:e,content:i});break;default:this.$emit(`action-${t}`,{index:e,content:i});break}},viewMessagesHandler({index:e,content:t}){this.selected=[e],this.$emit("action-view-data",{index:e,content:t})},copyMessageHandler({index:e,content:t}){Object(h["a"])(JSON.stringify(t)).then((e=>{this.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(e=>{this.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},actionToBottomHandler(){this.realtimeEnabled?(this.autoscroll=!0,this.scrollTo(this.messages.length-1)):this.$store.dispatch(`${this.moduleName}/getHistory`,1e3).then((()=>{this.scrollTo(this.messages.length-1)}))},async actionToNewMessages(){this.hasNewMessages=null;const e=Date.now(),t=new Date(e).setHours(0,0,0,0),i=t+86399999;this.from=t,this.to=i,this.$store.commit(`${this.moduleName}/clearMessages`),this.getMessages()},actionToNewMessagesHide(){this.hasNewMessages=null},clearMessage(e){return Object.keys(e).reduce(((t,i)=>(-1!==i.indexOf("x-flespi")||(t[i]=e[i]),t)),{})},unselect(){this.selected.length&&(this.selected=[])},nextSelect(){if(this.selected.length){const e=this.selected.slice(-1)[0],t=e+1,i=this.messages[t];i&&(this.selected=[t],this.$emit("action-select",{index:t,content:this.clearMessage(i)}),this.scrollTo(t))}},prevSelect(){if(this.selected.length){const e=this.selected[0],t=e-1,i=this.messages[t];i&&(this.selected=[t],this.$emit("action-select",{index:t,content:this.clearMessage(i)}),this.scrollTo(t))}},scrollControlling(e){this.selected.length&&this.selected[0]+1e3<=e&&this.$store.dispatch(`${this.moduleName}/unsubscribePooling`)},async init(){this.$store.state[this.moduleName]?this.$store.commit(`${this.moduleName}/clear`):this.$store.registerModule(this.moduleName,Object(d["d"])({Vue:m["default"],LocalStorage:this.$q.localStorage,name:{name:this.moduleName,lsNamespace:"flespi-toolbox-settings.cols"},errorHandler:e=>{this.$store.commit("reqFailed",e)}})),this.currentLimit=this.limit;let e=k()(this.$store.state.sessionSettings,"savedFilter","");if(e&&(this.needRestoreSettings&&(e=k()(e,`devices.${this.activeId}`,""),this.filter=e),this.$store.commit("setToolboxSessionSettings",{savedFilter:void 0})),this.activeId){const e=Math.floor(1e3*this.$route.query.from),i=Math.floor(1e3*this.$route.query.to),s=this.$route.query.messages;if(s)try{s=JSON.parse(s),s.filter&&(this.filter=s.filter),s.from&&s.to&&(e=Math.floor(1e3*s.from),i=Math.floor(1e3*s.to))}catch(t){}this.$store.commit(`${this.moduleName}/setActive`,this.activeId),await this.$store.dispatch(`${this.moduleName}/getCols`,{etc:!0}),e&&i?(this.from=e,this.to=i,await this.getMessages()):(await this.$store.dispatch(`${this.moduleName}/initTime`),await this.getMessages())}}},watch:{activeId(e){this.active=e},limit(e){this.currentLimit=e}},created(){this.init(),this.offlineHandler=m["default"].connector.socket.on("offline",(()=>{this.$store.commit(`${this.moduleName}/setOffline`)})),this.connectHandler=m["default"].connector.socket.on("connect",(()=>{this.$store.state[this.moduleName].offline&&(this.$store.commit(`${this.moduleName}/setReconnected`),this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/getMissedMessages`),this.$store.commit(`${this.moduleName}/clearOfflineState`))}))},beforeDestroy(){this.$store.dispatch(`${this.moduleName}/unsubscribePooling`),void 0!==this.offlineHandler&&m["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&m["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit(`${this.moduleName}/clear`)},mixins:[N["a"]],components:{VirtualScrollList:d["b"],EmptyPane:g["a"]}},W=M,C=Object($["a"])(W,r,c,!1,null,null,null),T=C.exports,S=i("df1d"),H=i("4596"),_=i("6512"),I=i("0860"),q={data(){return{isWidgetsTrackActive:!1,trackWidgetMessageMarker:void 0,trackWidgetConfig:{track:{title:"Track",wrapper:I["a"]}}}},methods:{showWidgetTrack(e){!this.isWidgetsTrackActive&&e.length&&(this.isWidgetsTrackActive=!0),this.$nextTick((()=>this.setWidgetTrackView("track",e)))},setWidgetTrackView(e,t){const i=this.$refs.track.ref(e);if(!i||!t)return;let s=t;const a=s[s.length-1];let o;a&&(o={latlng:[a.lat,a.lon],direction:a.dir,label:"Last position"}),s=s.map((e=>[e.lat,e.lon])),i.clear(),s.length&&i.addPoints(s),o&&i.addNamedMarkers(n()({position:o},this.trackWidgetMessageMarker)),i.send(),this.activateWidgetWindow("track")},addWidgetTrackMarker(e,t){if(!this.isWidgetsTrackActive)return;const i=this.$refs.track.ref(e);if(i){if(t){const{content:e}=t,s={message:{latlng:[e["position.latitude"],e["position.longitude"]],direction:e["position.direction"],color:"#f0f",label:"Message"}};this.trackWidgetMessageMarker=s,i.addNamedMarker(s)}else this.trackWidgetMessageMarker=void 0;i.send()}},closeWidgetsHandler(){}}},A=i("5c16"),V=i("a99a"),L=i("b06b"),E=i("2f62"),O=i("286e"),R=i("0644"),D=i.n(R),P={props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config","settings"],mixins:[O["a"],S["a"],H["a"],_["a"],q],data(){return{entityName:"devices",filter:"",active:null,isInit:!1,isItemsInit:!1,isItemsInitStart:!1,needShowGetDeletedAction:!0,trafficRoute:null,needRestoreSettings:!1}},computed:n()(n()({},Object(E["d"])({isEmptyMessages(e){return this.config.messages&&e[this.config.messages.vuexModuleName]&&!e[this.config.messages.vuexModuleName].messages.length&&100!==this.ratio},isEmptyData(e){const t=this.isEmptyMessages,i=this.config.logs&&e[this.config.logs.vuexModuleName]&&e[this.config.logs.vuexModuleName].messages&&!e[this.config.logs.vuexModuleName].messages.length&&0!==this.ratio;return t&&i},tokenType(e){return e.tokenInfo&&e.tokenInfo.access?e.tokenInfo.access.type:-1},itemsCollection(e){return e.devices||{}},tasksByDevice(e){return Object.values(e.tasks||{})},trackByMessages(e){const t=this.config&&this.config.messages&&e[this.config.messages.vuexModuleName]?e[this.config.messages.vuexModuleName].messages:[],i=[];for(let s=0;s<t.length;s++){const e=t[s];e["position.latitude"]&&e["position.longitude"]&&i.push({lat:e["position.latitude"],lon:e["position.longitude"],dir:e["position.direction"]})}return this.isWidgetsTrackActive&&this.setWidgetTrackView("track",i),i}})),{},{items(){return Object.values(this.itemsCollection)},selectedItem(){const e=this.itemsCollection&&this.itemsCollection[this.active]||null;return e&&(e.deleted&&this.deletedHandler(),this.getTrafficRoute(e)),e},logsConfig(){const e=this.config.logs;return this.trafficRoute?e.itemSettings.needTrafficRoute=!0:e.itemSettings.needTrafficRoute=!1,e},filteredItems(){const e=this.filter.toLowerCase(),t=this.filter?this.items.filter((t=>t&&"undefined"!==typeof t.name&&null!==t.name&&t.name.toLowerCase().indexOf(e)>=0||t&&"undefined"!==typeof t.id&&null!==t.id&&(t.id+"").indexOf(e)>=0||t&&t.configuration&&"undefined"!==typeof t.configuration.ident&&null!==t.configuration.ident&&t.configuration.ident.toLowerCase().indexOf(e)>=0)):this.items;return t.sort(((e,t)=>{if(!e.name)return-1;if(!t.name)return 1;const i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:1})),t},size(){return[this.ratio,100-this.ratio]},messagesConfig(){const e=D()(this.config.messages);return this.trafficRoute&&e.actions.push({icon:"mdi-download-network-outline",label:"View traffic",classes:"",type:"traffic"}),e},actions(){return[{label:"Intervals",icon:"mdi-set-center",handler:()=>this.moveToIntervals(this.active,null),condition:!!this.tasksByDevice.length},{label:"Traffic",icon:"mdi-download-network-outline",handler:this.trafficViewHandler,condition:this.trafficRoute&&this.$q.platform.is.mobile},{label:"Map",icon:"mdi-map",handler:()=>this.showWidgetTrack(this.trackByMessages),condition:!!this.trackByMessages.length},{label:"TrackIt",icon:"mdi-map-marker-path",handler:()=>this.goToTrackit(),condition:!!this.trackByMessages.length},{label:"Clear",icon:"mdi-playlist-remove",handler:this.clearHandler,condition:!this.isEmptyMessages}]},panelsWidgetsStyle(){const e={},t={track:this.isWidgetsTrackActive,data:this.isWidgetsMessageActive||this.isWidgetsLogsActive},i=this.widgetStyle.left&&this.widgetStyle.right&&t.track&&t.data,s=this.widgetStyle.left&&t[this.widgetStyle.left],a=this.widgetStyle.right&&t[this.widgetStyle.right];return i?(e.maxWidth="calc(100% - 600px)",e.left="300px"):(s||a)&&(e.maxWidth="calc(100% - 300px)",a&&(e.left="300px")),e},ratio(){return k()(this.settings.viewSettings,`${this.entityName}.ratio`,50)}}),methods:n()(n()({},Object(E["b"])(["getDeleted","getDeviceTrafficRoute"])),{},{clearHandler(){this.$q.dialog({title:"Confirm",message:"Do you really want to clear all data from the panes?",ok:!0,cancel:!0}).onOk((()=>{this.$store.commit(`${this.config.messages.vuexModuleName}/clearMessages`),this.$store.commit(`${this.config.logs.vuexModuleName}/clearMessages`),this.isWidgetsLogsActive?(this.isWidgetsLogsActive=!1,this.closeLogsWidgetsHandler()):this.isWidgetsMessageActive&&(this.isWidgetsMessageActive=!1,this.closeMessageWidgetsHandler())})).onCancel((()=>{}))},async getDeletedHandler(){await this.getDeleted(this.entityName),this.needShowGetDeletedAction=!1,this.$refs.itemSelect.reset()},clearActive(){this.active=null},deletedHandler(){this.changeRatioHandler(100)},getTrafficRoute(e){this.trafficRoute=null;const t=e.configuration?e.configuration.ident:"";if(!t)return!1;this.getDeviceTrafficRoute({id:e.id,ident:t}).then((e=>{this.trafficRoute=e}))},trafficViewHandler(){this.$router.push(this.trafficRoute).catch((e=>e)),this.saveSessionMessageFilter()},toTrafficHandler({content:e}){const t=e["server.timestamp"]||e.timestamp,i=t,s=i-10;this.trafficRoute&&this.$router.push({path:this.trafficRoute,query:{from:s,to:i}}).catch((e=>e)),this.saveSessionMessageFilter()},init(){const e=this.entityName,t=k()(this.settings,`entities[${e}]`,void 0);let i=this.$route.params&&this.$route.params.id?this.$route.params.id:null;const s=this.$route.query.view_mode;if(s){let e=50;"messages"===s?e=0:"logs"===s&&(e=100),this.$emit("update:settings",{type:"ENTITY_VIEW_SETTINGS_CHANGE",opt:{entity:this.entityName},value:{ratio:e}})}this.isInit=!0,i?(i=Number(i),this.itemsCollection[i]?this.active=i:this.active=null):t&&this.itemsCollection[t]&&(this.active=t),this.selectedItem&&this.selectedItem.deleted&&this.deletedHandler(),this.$emit("inited")},moveToIntervals(e,t){this.$nextTick((()=>{this.$router.push(`/device/${e}/calc/${t}/intervals?noselect=devices`).catch((e=>e))}))},saveSessionMessageFilter(){const e=k()(this.$store.state,`${this.config.messages.vuexModuleName}.filter`,"");e&&this.$store.commit("setToolboxSessionSettings",{savedFilter:{[this.entityName]:{[this.active]:e}}})},clearWidgetsState(){this.isWidgetsMessageActive=!1,this.isWidgetsLogsActive=!1,this.isWidgetsTrackActive=!1,this.activeWidgetWindow=void 0,this.widgetsViewedMessage=null,this.widgetsViewedLog=null},beforeEnableWidgetByPane(e){switch(this.widgetStyle.left||this.isWidgetsMessageActive||this.isWidgetsLogsActive||this.widgetsViewModel.data||this.$nextTick((()=>this.widgetsChangeViewModelHandler(this.entityName,"data",{type:"minimized",to:"left"}))),e){case"messages":this.isWidgetsLogsActive=!1,this.closeLogsWidgetsHandler();break;case"logs":this.isWidgetsMessageActive=!1,this.closeMessageWidgetsHandler();break}},onResizePage(e){this.$refs.track.resize(e),this.$refs.messagesView.resize(e),this.$refs.logsView.resize(e)},changeRatioHandler(e){this.ratioWidgetsModify(e),this.$emit("update:settings",{type:"ENTITY_VIEW_SETTINGS_CHANGE",opt:{entity:this.entityName},value:{ratio:e}}),this.$nextTick((()=>{+this.size[0]&&this.active&&this.$refs.logs.resetParams(),+this.size[1]&&this.active&&this.$refs.messages.resetParams()}))},goToTrackit(){const e=this.config&&this.config.messages&&this.$store.state[this.config.messages.vuexModuleName],t=Math.floor(e.from/1e3),i=Math.floor(e.to/1e3);Object(L["a"])(`${this.$flespiServer}/trackit/#/login/${this.$store.state.token}/devices/${this.active}?from=${t}&to=${i}`)}}),beforeRouteEnter(e,t,i){i((e=>{"trafficViewer"===t.meta.moduleName&&(e.needRestoreSettings=!0)}))},watch:{$route(e){e.params&&e.params.id?this.itemsCollection[Number(e.params.id)]?this.active=Number(e.params.id):this.isInit&&(this.active=null):e.params&&!e.params.id&&(this.active=null),this.clearWidgetsState()},active(e,t){const i=this.itemsCollection[e]||{};e?(this.$emit("update:settings",{type:"ENTITY_CHANGE",opt:{entity:this.entityName},value:i.id}),this.$router.push(`/devices/${e}`).catch((e=>e))):this.$router.push("/devices").catch((e=>e)),i.deleted&&this.deletedHandler()}},components:{logs:l["a"],messages:T,Widgets:A["a"],EntitiesToolbar:V["a"]}},z=P,j=(i("e6ba"),i("9989")),F=i("3980"),B=i("ddd8"),G=i("27f9"),Q=i("0016"),Y=i("9c40"),J=i("66e5"),U=i("4074"),Z=i("0170"),K=i("8572"),X=i("eebe"),ee=i.n(X),te=Object($["a"])(z,s,a,!1,null,"44df9f06",null);t["default"]=te.exports;ee()(te,"components",{QPage:j["a"],QResizeObserver:F["a"],QSelect:B["a"],QInput:G["a"],QIcon:Q["a"],QBtn:Y["a"],QItem:J["a"],QItemSection:U["a"],QItemLabel:Z["a"],QField:K["a"]})},e6ba:function(e,t,i){"use strict";i("63c9")},f229:function(e,t,i){"use strict";i("9633")}}]);
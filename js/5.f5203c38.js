(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{1635:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[i("entities-toolbar",{attrs:{item:e.selectedItem}},[i("div",{staticClass:"flex",class:{"middle-modificator":!e.active},attrs:{slot:"selects"},slot:"selects"},[i("div",{staticStyle:{display:"inline-flex"},style:{maxWidth:e.needShowBackToChannel&&e.needShowBackToDevice?"calc(100% - 150px)":e.needShowBackToChannel||e.needShowBackToDevice?"calc(100% - 80px)":"100%"}},[i("q-select",{ref:"itemSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.active},attrs:{value:e.active,options:e.filteredItems,filled:"",loading:e.isItemsInitStart&&!e.isItemsInit,label:e.active?"Channel":"SELECT CHANNEL",dark:"","hide-bottom-space":"",dense:"",color:"white",disable:!e.isNeedSelect||"string"===typeof e.isNeedSelect&&e.isNeedSelect.indexOf("channels")>-1,"hide-dropdown-icon":!e.isNeedSelect||"string"===typeof e.isNeedSelect&&e.isNeedSelect.indexOf("channels")>-1,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredItems.length>6?6:e.filteredItems.length)+48+"px"}},on:{filter:function(t,i){return e.filterItems("channels",t,i)}},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("div",[i("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),i("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(t){return[e.selectedItem?i("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedItem.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-white ellipsis",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(e.selectedItem.uri||"<no uri>"))])])],1),i("q-item-section",{staticClass:"text-white",attrs:{side:""}},[i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[i("small",[e._v("#"+e._s(e.selectedItem.id))])])],1)],1):e._e()]}},e.filteredItems.length?{key:"option",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(i){e.active=t.opt.id}}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(t.opt.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(t.opt.uri||"<no uri>"))])])],1),i("q-item-section",{attrs:{side:""}},[i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[i("small",[e._v("#"+e._s(t.opt.id))])])],1)],1)]}}:null],null,!0)},[i("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[i("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1)])],1),i("transition-group",{attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[e.needShowBackToChannel?i("q-btn",{key:"channel",staticClass:"on-right pull-right text-center rounded-borders q-px-xs q-py-none text-white",staticStyle:{width:"60px"},attrs:{title:"View channels",flat:"",dense:""},on:{click:e.viewLogsHandler}},[i("q-icon",{attrs:{size:"1.5rem",color:"white",name:"merge_type"}}),i("div",{staticStyle:{"font-size":".7rem","line-height":".7rem"}},[e._v("Channel")])],1):e._e(),e.needShowBackToDevice?i("q-btn",{key:"device",staticClass:"on-right pull-right text-center rounded-borders q-px-xs q-py-none text-white",staticStyle:{width:"60px"},attrs:{title:"View devices",flat:"",dense:""},on:{click:e.goToDevice}},[i("q-icon",{attrs:{size:"1.5rem",color:"white",name:"mdi-developer-board"}}),i("div",{staticStyle:{"font-size":".7rem","line-height":".7rem"}},[e._v("Device")])],1):e._e()],1)],1)]),e.active?i("traffic-viewer",{staticClass:"flex",attrs:{active:e.active,"active-device":e.activeDevice,isVisibleToolbar:e.isVisibleToolbar,"device-closeble":e.needShowBackToChannel,config:e.config},on:{"change-active-device":e.changeActiveDeviceHandler}}):e._e(),!e.items.length&&e.isItemsInit?i("div",{staticClass:"text-center text-grey-3 q-mt-lg",staticStyle:{"font-size":"2rem"}},[e._v(e._s(e.isLoading?"Fetching data..":"Compatible channels not found"))]):e._e()],1)},a=[],o=i("ded3"),n=i.n(o),l=(i("4e82"),i("13d5"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.activeDevice?i("messages",{directives:[{name:"show",rawName:"v-show",value:e.$q.platform.is.desktop||e.$q.platform.is.mobile&&!e.selectedMessages,expression:"$q.platform.is.desktop || ($q.platform.is.mobile && !selectedMessages)"}],ref:"messages",style:{height:"calc(100vh - "+(e.isVisibleToolbar?"100px":"50px")+")",position:"relative",width:e.$q.platform.is.desktop?"25%":"100%",minWidth:"250px"},attrs:{activeId:e.active,limit:e.limit,config:e.config.messages,"device-closeble":e.deviceCloseble,device:e.activeDevice,view:e.typeOfHexView},on:{"view-data":function(t){e.selectedMessages=t},close:function(){e.$emit("change-active-device",null),e.selectedMessages=""}}}):i("devices",{directives:[{name:"show",rawName:"v-show",value:e.$q.platform.is.desktop||e.$q.platform.is.mobile&&!e.selectedMessages,expression:"$q.platform.is.desktop || ($q.platform.is.mobile && !selectedMessages)"}],ref:"devices",style:{height:"calc(100vh - "+(e.isVisibleToolbar?"100px":"50px")+")",position:"relative",width:e.$q.platform.is.desktop?"25%":"100%",minWidth:"250px"},attrs:{activeId:e.active,config:e.config.messages,device:e.activeDevice,view:e.typeOfHexView},on:{"view-data":function(t){e.selectedMessages=t},"change:device":function(t){e.$emit("change-active-device",t)},close:function(){e.$emit("change-active-device",null),e.selectedMessages=""},"device:preview":e.previewShow,"device:preview-hide":e.previewHide}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.$q.platform.is.desktop||e.$q.platform.is.mobile&&e.selectedMessages,expression:"$q.platform.is.desktop || ($q.platform.is.mobile && selectedMessages)"}],style:{width:e.$q.platform.is.desktop?"75%":"100%",maxWidth:e.$q.platform.is.desktop?"calc(100% - 250px)":""}},[e.activeDevice?i("q-toolbar",{staticClass:"bg-grey-9"},[e.$q.platform.is.mobile?i("q-icon",{staticClass:"cursor-pointer",attrs:{color:"white",size:"1.5rem",name:"mdi-close"},nativeOn:{click:function(t){return function(){e.selectedMessages=""}.apply(null,arguments)}}}):e._e(),i("q-toolbar-title",[i("div",{staticClass:"text-white"},[e._v(e._s(e.activeDevice.ident))])]),i("q-btn",{attrs:{color:"white",flat:"",dense:"",label:"hex"===e.typeOfHexView?"text":"hex","icon-right":"hex"===e.typeOfHexView?"mdi-format-text":"mdi-matrix"},on:{click:function(t){e.typeOfHexView="hex"===e.typeOfHexView?"text":"hex"}}},[i("q-tooltip",[e._v("Change view mode to "+e._s("hex"===e.typeOfHexView?"text":"hex"))])],1),e.activeDevice?i("q-btn",{attrs:{color:"white",flat:"",dense:"",icon:"mdi-export-variant"}},[i("q-tooltip",[e._v("Export")]),i("q-menu",[i("q-list",{staticClass:"bg-grey-8 text-white",staticStyle:{"min-width":"150px"}},[i("div",{staticClass:"q-pa-sm"},[i("div",{staticStyle:{"font-size":".8rem"}},[e._v("Copy selected packets as")]),i("div",[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"shown"},on:{click:function(t){return e.copySelected()}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"hex"},on:{click:function(t){return e.copySelected("hex")}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"raw"},on:{click:function(t){return e.copySelected("text")}}})],1)]),i("q-separator"),i("div",{staticClass:"q-pa-sm"},[i("div",{staticStyle:{"font-size":".8rem"}},[e._v("Export selected packets as")]),i("div",[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"shown"},on:{click:function(t){return e.exportSelected()}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"hex"},on:{click:function(t){return e.exportSelected("hex")}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!e.selectedMessages.length,dense:"",flat:"",label:"raw"},on:{click:function(t){return e.exportSelected("text")}}})],1)]),i("q-separator"),i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.$refs.messages&&e.$refs.messages.exportModalOpen()}}},[i("q-item-section",[e._v("Export by time")])],1)],1)],1)],1):e._e()],1):e._e(),e.activeDevice?i("packet-view",{style:{height:"calc(100vh - "+(e.isVisibleToolbar&&e.activeDevice?"150px":"100px")+")",position:"relative",overflow:"auto"},attrs:{packets:e.selectedMessages,view:e.typeOfHexView}}):e.$q.platform.is.desktop&&e.devicePreview&&e.devicePreviewMessages.length?i("div",{staticClass:"q-pa-md",staticStyle:{overflow:"hidden","max-height":"calc(100vh - 100px)"}},[i("q-timeline",{attrs:{layout:"loose",color:"white",dark:""}},e._l(e.devicePreviewMessages,(function(t,s){return i("message-preview-item",{key:s,attrs:{message:t,view:e.typeOfHexView}})})),1)],1):i("div",{staticStyle:{"text-align":"center",color:"#9e9e9e","font-size":"3rem","padding-top":"40px"}},[i("div",[e._v("Select ident")]),i("q-icon",{attrs:{name:"mdi-arrow-down-bold-outline",size:"3rem"}}),i("div",[e._v("Find message")]),i("q-icon",{attrs:{name:"mdi-arrow-down-bold-outline",size:"3rem"}}),i("div",[e._v("Analyze data")])],1)],1)],1)}),c=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"wrapper"},[i("q-resize-observer",{on:{resize:e.wrapperResizeHandler}}),i("div",[i("q-toolbar",{staticClass:"bg-grey-9"},[e.deviceCloseble?i("q-btn",{staticClass:"text-white",attrs:{flat:"",dense:"",rounded:"",icon:"mdi-arrow-left"},on:{click:e.closeDevice}},[i("q-tooltip",[e._v("Close current device")])],1):e._e(),e.deviceCloseble?i("q-toolbar-title"):e._e(),i("date-range-modal",{staticClass:"flex flex-center",attrs:{date:e.dateRange,theme:e.theme},on:{save:e.dateRangeChangeHandler}})],1),e.loadingFlag&&e.itemsCount>0?i("div",{staticClass:"absolute-bottom-right absolute-top-left",staticStyle:{overflow:"hidden",top:"50px"}},e._l(new Array(e.itemsCount).fill(""),(function(e,t){return i("message-skeleton",{key:t})})),1):!e.loadingFlag&&e.messages.length?[i("VirtualList",{ref:"scroller",class:{"bg-grey-9":!0,"text-white":!0,"cursor-pointer":!0},style:{position:"absolute",top:"50px",bottom:0,right:0,left:0,height:"auto"},attrs:{onscroll:e.listScroll,size:e.itemHeight,remain:e.itemsCount,wclass:"q-w-list"}},e._l(e.messages,(function(t,s){return i("messages-list-item",{key:s,attrs:{item:t,index:s,actions:e.actions,itemHeight:e.itemHeight,selected:e.selected.includes(s),view:e.view,highlight:e.highligtedConnection[s]},on:{action:e.actionHandler,"item-click":e.messageClickHandler},nativeOn:{mouseenter:function(i){e.activeConnectionId=t.conn},mouseleave:function(t){e.activeConnectionId=null}}})})),1)]:i("empty-pane",{attrs:{config:e.config.emptyState}})],2),i("export-modal",{ref:"export",attrs:{format:e.view,dateRange:e.dateRange,config:e.config,ident:e.device.ident,"item-id":e.activeId}})],1)},d=[],h=(i("ddb0"),i("89c1")),m=i.n(h),p=i("9b02"),u=i.n(p),v=i("de45"),g=i("cdde"),f=i("e812"),w=i("121a"),$=i("3ba5"),b=i("5a3a"),x=i.n(b),y=i("5de8"),q={props:["activeId","device","limit","config","view","deviceCloseble"],data(){return{theme:this.config.theme,viewConfig:this.config.viewConfig,actions:this.config.actions,moduleName:this.config.vuexModuleName,itemHeight:53,itemsCount:0,wrapperHeight:0,needAutoScroll:!0,selected:[],scrollerScrollTop:0,activeConnectionId:null}},computed:{messages:{get(){return this.$store.state[this.moduleName].messages},set(e){this.$store.commit(`${this.moduleName}/setMessages`,e)}},currentLimit:{get(){return this.$store.state[this.moduleName].limit},set(e){this.$store.commit(`${this.moduleName}/setLimit`,e)}},dateRange(){return[this.$store.state[this.moduleName].from,this.$store.state[this.moduleName].to]},from:{get(){return this.$store.state[this.moduleName].from},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setFrom`,e)}},to:{get(){return this.$store.state[this.moduleName].to},set(e){e=e||0,this.$store.commit(`${this.moduleName}/setTo`,e)}},realtimeEnabled(){return this.$store.state[this.moduleName].messagePolling},loadingFlag(){const e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)},highligtedConnection(){let e={};return this.activeConnectionId&&(e=this.messages.reduce(((e,t,i)=>(t.conn===this.activeConnectionId&&(e[i]=!0),e)),{})),e}},methods:{resetParams(){if(!this.$refs.wrapper)return!1;if(this.wrapperHeight=this.$refs.wrapper.offsetHeight-this.itemHeight,this.itemsCount=Math.ceil(this.wrapperHeight/this.itemHeight),this.$refs.scroller&&this.$refs.scroller.forceRender(),this.$refs.scroller&&this.$refs.scroller.$el){const e=this.$refs.scroller.$el;e.scrollTop+=1}},dateRangeChangeHandler(e){const t=e[0],i=e[1];if(this.from===t&&this.to===i)return!1;this.from=t,this.to=i,this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/removePollingGetMessages`),this.needAutoScroll&&i<=Date.now()&&(this.needAutoScroll=!1),this.$store.commit(`${this.moduleName}/clearMessages`),this.$store.dispatch(`${this.moduleName}/getMessages`).then((()=>{i>Date.now()&&this.$store.dispatch(`${this.moduleName}/pollingGetMessages`)}))},clearSelected(){this.selected=[]},wrapperResizeHandler(){this.resetParams()},getScrollDirection(e){let t=null;return t=e>this.currentScrollTop?"bottom":e<this.currentScrollTop?"top":"none",t},listScroll:function(e,t){const{offset:i}=t;this.currentScrollTop||(this.currentScrollTop=i);const s=u()(this.$refs,"scroller.$el",void 0),a=s.scrollHeight-s.clientHeight,o=this.getScrollDirection(i),n=.1*a;this.allScrollTop=this.$refs.scroller?this.$refs.scroller.$el.scrollHeight-this.$refs.scroller.$el.clientHeight:0,this.messages.length&&(i<this.currentScrollTop&&this.needAutoScroll?this.needAutoScroll=!1:!this.needAutoScroll&&this.realtimeEnabled&&i>=this.allScrollTop&&(this.needAutoScroll=!0),this.currentScrollTop=i),o&&("top"===o||"none"===o)&&i<n?this.getMessagesPrev():o&&("bottom"===o||"none"===o)&&i+n>=a&&this.getMessagesNext()},getMessagesPrev(){const e=u()(this.$refs,"scroller.$el",void 0),t=e.scrollHeight-e.clientHeight,i=e.scrollTop;this.$store.dispatch(`${this.moduleName}/getMessagesPrev`).then((s=>{if(s&&s.length){const s=e.scrollHeight-e.clientHeight;e.scrollTop=s-t+i}}))},getMessagesNext(){this.$store.dispatch(`${this.moduleName}/getMessagesNext`)},actionHandler({index:e,type:t,content:i}){switch(t){case"view":this.viewMessagesHandler({index:e,content:i});break;case"copy":this.copyMessageHandler({index:e,content:i});break}},viewMessagesHandler({index:e,content:t}){this.selected=[e],this.$root.$emit("view-data",t)},messageClickHandler({index:e,content:t,event:i}){if(i.shiftKey)this.selected[0]?this.selected[0]>e?this.selected=x()(e,this.selected[0]+1):this.selected=x()(this.selected[0],e+1):this.selected=[e];else if(i.ctrlKey||i.metaKey)if(this.selected.includes(e)){const t=this.selected;t.splice(this.selected.indexOf(e),1),this.selected=t}else this.selected=[...this.selected,e];else this.selected=[e];this.needAutoScroll&&(this.needAutoScroll=!1),this.selected.sort(((e,t)=>e-t)),this.$emit("view-data",this.selected.map((e=>n()(n()({},this.messages[e]),{},{index:e}))))},copyMessageHandler({index:e,content:t}){Object(g["a"])(JSON.stringify(t)).then((e=>{this.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(e=>{this.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},unselect(){this.selected.length&&(this.selected=[])},closeDevice(){this.$emit("close")},clear(){this.realtimeEnabled&&this.$store.dispatch(`${this.moduleName}/removePollingGetMessages`),this.$store.commit(`${this.moduleName}/clearMessages`),this.closeDevice()},exportModalOpen(){this.$refs.export.show()},highlightIncoming(e){const t=this.messages.findIndex((e=>2===e.type)),i=this.messages.findIndex((t=>2===t.type&&Math.floor(t.timestamp)===Math.floor(e)));i>-1?this.messageClickHandler({index:i,event:{}}):t>-1&&this.messageClickHandler({index:t,event:{}})},async init(){this.currentLimit=this.limit,this.activeId&&!this.$store.state[this.moduleName].active&&this.$store.commit(`${this.moduleName}/setActive`,this.activeId),this.device&&!this.$store.state[this.moduleName].ident&&this.$store.commit(`${this.moduleName}/setIdent`,this.device.ident);const e=1e3*this.$route.query.from,t=1e3*this.$route.query.to,i=this.$route.query.highlight||e;e&&t?(this.from=e,this.to=t,await this.$store.dispatch(`${this.moduleName}/getMessages`),this.$nextTick((()=>this.highlightIncoming(i)))):(await this.$store.dispatch(`${this.moduleName}/initTime`),await this.$store.dispatch(`${this.moduleName}/getMessagesTail`)),this.to>Date.now()&&await this.$store.dispatch(`${this.moduleName}/pollingGetMessages`)}},watch:{activeId(e){this.clear()},limit(e){this.currentLimit=e}},created(){this.init()},mounted(){this.resetParams()},updated(){this.messages.length?this.needAutoScroll&&this.$refs.scroller&&this.$refs.scroller.$el&&(this.$refs.scroller.$el.scrollTop=this.$refs.scroller.$el.scrollHeight):this.currentScrollTop=0},destroyed(){this.$store.dispatch(`${this.moduleName}/removePollingGetMessages`),this.$store.commit(`${this.moduleName}/clearMessages`),this.to=0,this.from=0},components:{MessagesListItem:f["a"],VirtualList:m.a,EmptyPane:w["a"],MessageSkeleton:$["a"],DateRangeModal:v["a"],ExportModal:y["a"]}},C=q,k=i("2877"),S=i("3980"),D=i("65c6"),M=i("9c40"),I=i("05c0"),N=i("6ac5"),_=i("eebe"),H=i.n(_),T=Object(k["a"])(C,r,d,!1,null,null,null),P=T.exports;H()(T,"components",{QResizeObserver:S["a"],QToolbar:D["a"],QBtn:M["a"],QTooltip:I["a"],QToolbarTitle:N["a"]});var E=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"wrapper"},[i("q-resize-observer",{on:{resize:e.wrapperResizeHandler}}),i("div",[i("q-toolbar",{staticClass:"bg-grey-9"},[i("q-input",{staticClass:"full-width",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"ident",debounce:500},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.loadingFlag&&e.itemsCount>0?i("div",{staticClass:"absolute-bottom-right absolute-top-left",staticStyle:{overflow:"hidden",top:"50px"}},e._l(new Array(e.itemsCount).fill(""),(function(e,t){return i("device-skeleton",{key:t})})),1):!e.loadingFlag&&e.devicesByIndex.length?[i("VirtualList",{ref:"scroller",class:{"bg-grey-9":!0,"text-white":!0,"cursor-pointer":!0},style:{position:"absolute",top:"50px",bottom:0,right:0,left:0,height:"auto"},attrs:{size:e.itemHeight,remain:e.itemsCount,wclass:"q-w-list"}},e._l(e.devices,(function(t,s){return i("device-list-item",{key:t.ident,attrs:{item:t,index:s,itemHeight:e.itemHeight},on:{"item-click":e.deviceClickHandler},nativeOn:{mouseenter:function(i){return e.previewDeviceHandler(t)},mouseleave:function(i){return e.previewDeviceCloseHandler(t)}}})})),1)]:i("empty-pane",{attrs:{config:e.config.emptyState}})],2)],1)},O=[],Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-item",{staticClass:"q-py-none",attrs:{clickable:""},on:{click:function(t){e.itemClickHandler(e.index,e.item,t)}}},[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis text-white q-pa-none",attrs:{header:""}},[e._v(e._s(e.ident))]),i("q-item-label",{staticClass:"ellipsis overflow-hidden text-grey-5",attrs:{caption:""}},[e._v(e._s(e.item.size?e.format.humanStorageSize(e.item.size):"new"))])],1)],1)},L=[],z=i("bd4c"),F=i("7937"),A={props:["item","index","itemHeight"],data(){return{date:z["a"],format:F["c"],ident:this.item.ident}},methods:{itemClickHandler(e,t,i){this.$emit("item-click",{index:e,content:t,event:i})}}},V=A,R=i("66e5"),B=i("4074"),G=i("0170"),j=Object(k["a"])(V,Q,L,!1,null,null,null),W=j.exports;H()(j,"components",{QItem:R["a"],QItemSection:B["a"],QItemLabel:G["a"]});var Y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-item",{staticClass:"bg-grey-9"},[i("q-item-section",[i("q-item-label",{staticClass:"q-pa-none bg-white full-width skeleton--modificator",staticStyle:{height:"16px"},attrs:{header:""}}),i("q-item-label",{staticClass:"bg-grey-6  full-width skeleton--modificator",staticStyle:{height:"15px"},attrs:{caption:""}})],1)],1)},J=[],K=(i("29e0"),{}),U=Object(k["a"])(K,Y,J,!1,null,null,null),X=U.exports;H()(U,"components",{QItem:R["a"],QItemSection:B["a"],QItemLabel:G["a"]});var Z={props:["activeId","device","config","view"],data(){return{theme:this.config.theme,viewConfig:this.config.viewConfig,actions:this.config.actions,moduleName:this.config.vuexModuleName,itemHeight:48,itemsCount:0,wrapperHeight:0}},computed:{selectedChannel(){const e=this.$store.state.channels[this.activeId],t=this.$store.state.channelsProtocols[e.protocol_id].features;return e.features=t,e},devices:{get(){return this.$store.state[this.moduleName].devices},set(e){this.$store.commit(`${this.moduleName}/setDevices`,e)}},devicesByIndex(){return Object.values(this.$store.state[this.moduleName].devices)},filter:{get(){return this.$store.state[this.moduleName].deviceFilter},set(e){this.$store.commit(`${this.moduleName}/setDeviceFilter`,e),this.$store.dispatch(`${this.moduleName}/getDevices`).then((()=>{this.$nextTick((()=>{this.$refs.scroller&&this.$refs.scroller.forceRender()}))}))}},active:{get(){return this.$store.state[this.moduleName].active},async set(e){this.realtimeEnabled&&await this.$store.dispatch(`${this.moduleName}/removePollingGetDevices`),this.$store.commit(`${this.moduleName}/setActive`,e),this.$store.commit(`${this.moduleName}/clearDevices`),await this.$store.dispatch(`${this.moduleName}/getDevices`),this.selectedChannel.features.shared_connection||await this.$store.dispatch(`${this.moduleName}/pollingGetDevices`)}},realtimeEnabled(){return this.$store.state[this.moduleName].realtimeEnabled},loadingFlag(){const e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)}},methods:{resetParams(){if(!this.$refs.wrapper)return!1;this.wrapperHeight=this.$refs.wrapper.offsetHeight-this.itemHeight,this.itemsCount=Math.ceil(this.wrapperHeight/this.itemHeight),this.$refs.scroller&&this.$refs.scroller.forceRender()},wrapperResizeHandler(){this.resetParams()},deviceClickHandler({index:e,content:t,event:i}){this.$store.commit(`${this.moduleName}/setIdent`,t.ident),this.$emit("change:device",t)},previewDeviceHandler(e){this.$emit("device:preview",e)},previewDeviceCloseHandler(e){this.$emit("device:preview-hide",e)},clearDevices(){this.devices={}}},watch:{activeId(e){this.active=e}},created(){const e=this.$route.query.filter;e&&this.$store.commit(`${this.moduleName}/setDeviceFilter`,e),this.activeId&&(this.active=this.activeId)},mounted(){this.resetParams()},components:{VirtualList:m.a,DeviceListItem:W,EmptyPane:w["a"],DeviceSkeleton:X}},ee=Z,te=i("27f9"),ie=i("0016"),se=Object(k["a"])(ee,E,O,!1,null,null,null),ae=se.exports;H()(se,"components",{QResizeObserver:S["a"],QToolbar:D["a"],QInput:te["a"],QIcon:ie["a"]});var oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-timeline-entry",{staticClass:"hex-viewer__timeline-element",attrs:{side:2===e.message.type||130===e.message.type?"left":"right",color:e.eventsColors[e.message.type]+"-6"}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("div",{staticStyle:{"line-height":"18px"}},[i("span",[e._v(e._s(e.eventsDesc[e.message.type]))])]),i("div",{staticClass:"text-grey-5",staticStyle:{"font-size":".7rem"}},[e._v("\n      "+e._s(e.date.formatDate(1e3*e.message.timestamp,"DD/MM/YYYY HH:mm:ss.SSS"))+"\n      "),i("small",{staticClass:"rounded-borders q-mx-xs q-px-xs text-white",class:{"bg-blue":"tcp"===e.transport,"bg-pink-4":"udp"===e.transport,"bg-green-9":"http"===e.transport,"bg-purple-9":"mqtt"===e.transport}},[e._v(e._s(e.transport))])])]),i("div",{staticClass:"ellipsis",staticStyle:{"word-break":"break-all","font-size":".8rem",height:"1rem"}},[e._v(e._s(e.dataPreview))])])},ne=[],le=i("c423"),ce={props:["message","view"],data(){return{date:z["a"],transports:{2:"tcp",66:"http",67:"http",130:"udp",3:"tcp",131:"udp",32:"mqtt",33:"mqtt",34:"mqtt",35:"mqtt"},eventsColors:{0:"green",32:"green",1:"red",33:"red",2:"purple",130:"purple",66:"purple",34:"purple",3:"yellow",67:"yellow",131:"yellow",35:"yellow"},eventsDesc:{0:"Connect",32:"Connect",1:"Disconnect",33:"Disconnect",2:"Data received",130:"Data received",66:"Data received",34:"Data received",3:"Data sent",67:"Data sent",131:"Data sent",35:"Data sent"},eventIcons:{0:"mdi-lan-connect",32:"mdi-lan-connect",1:"mdi-lan-disconnect",33:"mdi-lan-disconnect",2:"mdi-arrow-right-thick",130:"mdi-arrow-right-thick",66:"mdi-arrow-right-thick",34:"mdi-arrow-right-thick",3:"mdi-arrow-left-thick",67:"mdi-arrow-left-thick",35:"mdi-arrow-left-thick",131:"mdi-arrow-left-thick"}}},computed:{dataPreview(){let e=this.base64ToHex(this.message.data)||"";if("text"===this.view&&e){const t=e.match(/.{1,2}/g);e=t.map((e=>this.replaceByteWithMnemo(e))).join("")}return e},transport(){return this.transports[this.message.type]}},mixins:[le["a"]]},re=ce,de=(i("cb33"),i("74af")),he=i("05eb"),me=Object(k["a"])(re,oe,ne,!1,null,null,null),pe=me.exports;H()(me,"components",{QTimelineEntry:de["a"],QTimeline:he["a"]});var ue=i("73bb"),ve=(i("26e9"),i("2b0e"));function ge(e){const t=e||Date.now(),i=new Date(t).setHours(0,0,0,0),s=i+86399999;return{from:i,to:s}}async function fe({state:e,commit:t}){let i=Date.now();try{const t=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{count:1,reverse:!0}});i=u()(t,"data.result[0].timestamp",Math.floor(Date.now()/1e3)),i=Math.round(1e3*i)}catch(a){}const s=ge(i);t("setFrom",s.from),t("setTo",s.to)}async function we({state:e,commit:t}){"undefined"!==typeof e.isLoading&&ve["default"].set(e,"isLoading",!0);try{const i=await ve["default"].connector.gw.getChannelsIdents(e.active,e.deviceFilter?`*${e.deviceFilter}*`:"*");let s=u()(i,"data.result",[]);s=s.reduce(((e,{ident:t,size:i})=>(e[t]={ident:t,size:i},e)),{}),t("setDevices",s)}catch(i){t("reqFailed",i)}"undefined"!==typeof e.isLoading&&ve["default"].set(e,"isLoading",!1)}async function $e({state:e,commit:t}){"undefined"!==typeof e.isLoading&&ve["default"].set(e,"isLoading",!0);try{const i=Date.now(),s=e.to>i?i:e.to,a=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{from:Math.floor(e.from/1e3),to:Math.floor(s/1e3),count:e.limit}}),o=u()(a,"data.result",[]);t("setMessages",o)}catch(i){t("reqFailed",i)}"undefined"!==typeof e.isLoading&&ve["default"].set(e,"isLoading",!1)}let be=!1;async function xe({state:e,commit:t}){if(!e.messages.length||be||e.messagePolling)return;be=!0;let i=[];try{const s=Math.ceil(e.messages[e.messages.length-1].timestamp),a=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{count:e.limit,from:s,to:Math.floor(e.to/1e3)}});i=u()(a,"data.result",[]),t("setMessagesAppend",i)}catch(s){t("reqFailed",s)}return be=!1,i}async function ye({state:e,commit:t}){if(!e.messages.length||be)return;be=!0;let i=[];try{const s=Math.floor(e.messages[0].timestamp)-1,a=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{count:e.limit,from:Math.floor(e.from/1e3),to:s,reverse:!0}});i=u()(a,"data.result",[]),i.reverse(),t("setMessagesPrepend",i)}catch(s){t("reqFailed",s)}return be=!1,i}async function qe({state:e,commit:t}){await ve["default"].connector.socket.subscribe({name:`flespi/log/gw/channels/${e.active}/connections/+/identified`,handler:(t,i,s)=>{t=JSON.parse(t.toString());const a=t.ident;e.devices[a]||-1===a.indexOf(e.deviceFilter)||ve["default"].set(e.devices,a,{ident:a})}}),e.realtimeEnabled=!0}async function Ce({state:e,commit:t}){e.realtimeEnabled=!1,await ve["default"].connector.socket.unsubscribe(`flespi/log/gw/channels/${e.active}/connections/+/identified`)}let ke=0;function Se({state:e,commit:t}){ke=setInterval((async()=>{try{const i=Math.ceil(e.messages[e.messages.length-1].timestamp),s=Math.ceil(Date.now()/1e3),a=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{from:i,to:s}}),o=u()(a,"data.result",[]);t("setMessagesAppend",o)}catch(i){t("reqFailed",i)}}),1e4),e.messagePolling=!0}function De({state:e,commit:t}){clearInterval(ke),ke=0,e.messagePolling=!1}async function Me({state:e},t){let i=[];try{const s=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,t.ident,{data:{count:20,reverse:!0}});i=u()(s,"data.result",[])}catch(s){}return i}async function Ie({state:e},{from:t,to:i}){let s=[];try{const a=await ve["default"].connector.gw.getChannelsIdentsPackets(e.active,e.ident,{data:{from:t,to:i}});s=u()(a,"data.result",[])}catch(a){}return s}var Ne={initTime:fe,getMessages:$e,getMessagesTail:getMessagesTail,getMessagesNext:xe,getMessagesPrev:ye,getDevices:we,pollingGetDevices:qe,removePollingGetDevices:Ce,pollingGetMessages:Se,removePollingGetMessages:De,getDevicePreview:Me,getExportData:Ie};function _e(e,t){e.limit=t}function He(e,t){e.active=t}function Te(e){e.messages=[]}function Pe(e){e.devices=[]}function Ee(e,t){e.devices=t}function Oe(e,t){e.messages=t}function Qe(e,t){e.messages.splice(e.messages.length,0,...t)}function Le(e,t){e.messages.splice(0,0,...t)}function ze(e,t){e.to=t}function Fe(e,t){e.from=t}function Ae(e,t){e.deviceFilter=t}function Ve(e,t){e.ident=t}function Re(e){e.devices={},e.messages=[],e.to=0,e.from=0,e.active=null,e.ident=null}function Be(e,t){}var Ge={setLimit:_e,setActive:He,clearMessages:Te,clearDevices:Pe,setDevices:Ee,setMessages:Oe,setMessagesAppend:Qe,setMessagesPrepend:Le,clean:Re,setTo:ze,setFrom:Fe,setDeviceFilter:Ae,setIdent:Ve,reqFailed:Be};const je={devices:{},messages:[],active:null,ident:null,limit:0,deviceFilter:"",from:0,to:0,isLoading:!1,realtimeEnabled:!1,messagePolling:!1};var We={namespaced:!0,state:je,actions:Ne,mutations:Ge},Ye=i("798f"),Je={props:["active","activeDevice","isVisibleToolbar","config","deviceCloseble"],data(){return{devicePreview:null,typeOfHexView:"hex",limit:1e3,selectedMessages:"",moduleName:this.config.messages.vuexModuleName,devicePreviewMessages:[]}},computed:{hex(){return!(!this.selectedMessages||!this.activeDevice)&&this.selectedMessages.reduce(((e,t)=>(e+=this.base64ToHex(t.data)||"",e)),"")}},methods:{async previewShow(e){this.devicePreview=e,this.devicePreviewMessages=await this.$store.dispatch(`${this.moduleName}/getDevicePreview`,e)},previewHide(e){this.devicePreview=null},getContentBySelected(e){return this.selectedMessages.reduce(((t,i)=>(t+=this.getHeader(i),t+="\r\n",i.data&&(t+=this.getContent(e,this.base64ToHex(i.data),this.typeOfHexView)),t+="\r\n",t)),"")},copySelected(e="view"){const t=this.getContentBySelected(e);this.copy(t,e)},exportSelected(e="view"){const t=this.getContentBySelected(e);this.exportData(t,e)}},created(){this.$store.state[this.moduleName]||this.$store.registerModule(this.moduleName,We)},destroyed(){this.$store.commit(`${this.moduleName}/clean`),this.$store.dispatch(`${this.moduleName}/removePollingGetDevices`),this.$store.unregisterModule(this.moduleName)},watch:{active(){this.selectedMessages="",this.devicePreview=null}},mixins:[Ye["a"]],components:{Devices:ae,Messages:P,MessagePreviewItem:pe,PacketView:ue["a"]}},Ke=Je,Ue=i("4e73"),Xe=i("1c1c"),Ze=i("eb85"),et=i("7f67"),tt=Object(k["a"])(Ke,l,c,!1,null,null,null),it=tt.exports;H()(tt,"components",{QToolbar:D["a"],QIcon:ie["a"],QToolbarTitle:N["a"],QBtn:M["a"],QTooltip:I["a"],QMenu:Ue["a"],QList:Xe["a"],QSeparator:Ze["a"],QItem:R["a"],QItemSection:B["a"],QTimeline:he["a"]}),H()(tt,"directives",{ClosePopup:et["a"]});var st=i("a99a"),at=i("2f62"),ot=i("286e"),nt={name:"PageTrafficViewer",props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config","settings"],mixins:[ot["a"]],data(){return{active:null,activeDevice:null,relatedDeviceId:null,isInit:!1,isItemsInit:!1,isItemsInitStart:!1,filter:"",prevEntity:null,isIntegration:this.$q.platform.within.iframe}},computed:n()(n()({},Object(at["d"])({tokenType(e){return e.tokenInfo&&e.tokenInfo.access?e.tokenInfo.access.type:-1},items(e){return Object.values(e.channels||{}).filter((t=>e.channelsProtocols[t.protocol_id].features.raw_packets))}})),{},{filteredItems(){const e=this.filter.toLowerCase(),t=this.filter?this.items.filter((t=>t&&"undefined"!==typeof t.name&&null!==t.name&&t.name.toLowerCase().indexOf(e)>=0||t&&"undefined"!==typeof t.id&&null!==t.id&&(t.id+"").indexOf(e)>=0)):this.items;return t.sort(((e,t)=>{if(!e.name)return-1;if(!t.name)return 1;const i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:1})),t},selectedItem(){return this.items.filter((e=>e.id===this.active))[0]||null},needShowBackToChannel(){return this.active&&(!this.isIntegration||this.isIntegration&&("channels"===this.prevEntity&&!this.isNeedSelect||this.isNeedSelect&&!("string"===typeof this.isNeedSelect&&this.isNeedSelect.indexOf("channels")>-1)))},needShowBackToDevice(){return this.active&&this.activeDevice&&this.relatedDeviceId&&(!this.isIntegration||this.isIntegration&&("devices"===this.prevEntity&&!this.isNeedSelect||this.isNeedSelect))}}),methods:{changeActiveDeviceHandler(e){this.setActiveDevice(e),this.active?this.activeDevice?this.$router.push(`/tools/traffic/${this.active}/ident/${e.ident}`).catch((e=>e)):this.$router.push(`/tools/traffic/${this.active}`).catch((e=>e)):this.$router.push("/tools/traffic").catch((e=>e))},unselect(){this.$refs.messages.unselect()},viewLogsHandler(){this.$router.push(`/channels/${this.active}`).catch((e=>e))},setActiveDevice(e){this.activeDevice=e,this.getRelatedDeviceId()},getRelatedDeviceId(){this.activeDevice?this.$connector.gw.getChannelProtocolsDeviceTypes(this.selectedItem.protocol_id,"all",{fields:"id"}).then((e=>{const t=u()(e,"data.result",[]);return t.map((e=>e.id))})).then((e=>{this.$connector.gw.getDevices(`configuration.ident=${this.activeDevice.ident}`,{fields:"id,device_type_id"}).then((t=>{const i=u()(t,"data.result",[]),s=i.reduce(((t,i)=>t||(e.includes(i.device_type_id)?i.id:t)),0);this.relatedDeviceId=s}))})):this.relatedDeviceId=null},goToDevice(){this.$router.push(`/devices/${this.relatedDeviceId}`).catch((e=>e))},init(){const e="tools/traffic",t=u()(this.settings,`entities[${e}]`,void 0);this.isInit=!0,this.$route.params&&this.$route.params.id?this.items.filter((e=>e.id===Number(this.$route.params.id))).length?(this.active=Number(this.$route.params.id),this.$route.params.ident&&this.setActiveDevice({ident:this.$route.params.ident})):this.active=null:t&&this.items.filter((e=>e.id===t)).length&&(this.active=t),this.$emit("inited")}},beforeRouteEnter(e,t,i){i((e=>{e.prevEntity=t.meta.moduleName}))},watch:{$route(e){e.params&&e.params.id?this.items.filter((t=>t.id===Number(e.params.id))).length?(this.active=Number(e.params.id),this.$route.params.ident&&this.setActiveDevice({ident:this.$route.params.ident})):this.isInit&&(this.active=null):e.params&&!e.params.id&&(this.active=null)},active(e){const t=this.items.filter((t=>t.id===e))[0]||{};e?(this.$emit("update:settings",{type:"ENTITY_CHANGE",opt:{entity:"tools/traffic"},value:t.id}),this.activeDevice?this.$router.push(`/tools/traffic/${e}/ident/${this.activeDevice.ident}`).catch((e=>e)):this.$router.push(`/tools/traffic/${e}`).catch((e=>e))):this.$router.push("/tools/traffic").catch((e=>e))}},components:{TrafficViewer:it,EntitiesToolbar:st["a"]}},lt=nt,ct=(i("8b7b"),i("9989")),rt=i("ddd8"),dt=i("8572"),ht=Object(k["a"])(lt,s,a,!1,null,null,null);t["default"]=ht.exports;H()(ht,"components",{QPage:ct["a"],QSelect:rt["a"],QInput:te["a"],QIcon:ie["a"],QItem:R["a"],QItemSection:B["a"],QItemLabel:G["a"],QBtn:M["a"],QField:dt["a"]})},2510:function(e,t,i){},"29e0":function(e,t,i){"use strict";i("69d5b")},"69d5b":function(e,t,i){},"8b7b":function(e,t,i){"use strict";i("2510")},cb33:function(e,t,i){"use strict";i("efe3")},efe3:function(e,t,i){}}]);